<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Veritas Guard ‚Äî Risk Awareness Tool</title>
<!-- Tesseract.js ‚Äî Browser OCR, No API needed -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.0.4/tesseract.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   VERITAS GUARD v1.5 ‚Äî DAYLIGHT THEME
   High contrast ¬∑ Outdoor readable
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root{
  --bg:#f0ede8;
  --bg2:#e8e4de;
  --surface:#ffffff;
  --surface2:#f7f5f2;
  --border:#d4cfc8;
  --border-strong:#b8b2aa;
  --ink:#1a1714;
  --ink2:#3d3830;
  --ink3:#6b6560;
  --accent:#1a1714;
  --brand:#1d4ed8;
  --brand2:#1e40af;
  --brand-light:#eff6ff;
  --v0:#4a5568;--v0bg:#edf2f7;--v0border:#cbd5e0;
  --v1:#276749;--v1bg:#f0fff4;--v1border:#9ae6b4;
  --v2:#c05621;--v2bg:#fffaf0;--v2border:#fbd38d;
  --v3:#9b2335;--v3bg:#fff5f5;--v3border:#feb2b2;
  --mono:'Space Mono',monospace;
  --sans:'DM Sans',sans-serif;
  --radius:10px;
  --shadow:0 1px 3px rgba(0,0,0,.08),0 4px 12px rgba(0,0,0,.06);
  --shadow-lg:0 4px 16px rgba(0,0,0,.12),0 12px 32px rgba(0,0,0,.08);
}

*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--ink);font-family:var(--sans);min-height:100vh;-webkit-font-smoothing:antialiased}

/* WARN BAR */
#warn-bar{position:fixed;top:0;left:0;right:0;z-index:100;background:var(--ink);padding:6px 0;overflow:hidden}
#warn-text{display:inline-block;white-space:nowrap;font-family:var(--mono);font-size:10px;color:#a8a29e;animation:marquee 32s linear infinite;padding-left:100%}
@keyframes marquee{from{transform:translateX(0)}to{transform:translateX(-200%)}}

#app{max-width:480px;margin:0 auto;padding:60px 14px 60px}

/* HEADER */
.header{text-align:center;padding:28px 0 20px;border-bottom:1px solid var(--border);margin-bottom:16px}
.logo-row{display:inline-flex;align-items:center;gap:10px;margin-bottom:6px}
.logo-icon{width:36px;height:36px;background:#1d4ed8;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px}
.logo-name{font-family:var(--mono);font-size:22px;font-weight:700;color:var(--ink);letter-spacing:-1px}
.tagline{font-family:var(--mono);font-size:9px;color:var(--ink3);letter-spacing:2px;text-transform:uppercase;margin-bottom:10px}

/* ENGINE STATUS PILL */
.engine-pill{display:inline-flex;align-items:center;gap:6px;padding:5px 14px;border-radius:20px;font-family:var(--mono);font-size:10px;border:1.5px solid;cursor:pointer;transition:all .2s;margin-bottom:4px}
.engine-pill.online{background:#f0fff4;border-color:#9ae6b4;color:#276749}
.engine-pill.offline{background:#fff5f5;border-color:#feb2b2;color:#9b2335}
.engine-pill.checking{background:var(--surface2);border-color:var(--border);color:var(--ink3)}
.engine-pill .dot{width:6px;height:6px;border-radius:50%;animation:blink 2s infinite}
.engine-pill.online .dot{background:#276749}
.engine-pill.offline .dot{background:#9b2335}
.engine-pill.checking .dot{background:var(--ink3)}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}

/* TRUST BADGE ‚Äî always visible when verified */
#trust-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 12px;border-radius:20px;font-family:var(--mono);font-size:9px;border:1.5px solid;margin-top:4px;transition:all .3s}
#trust-badge.locked{background:#f0fff4;border-color:#9ae6b4;color:#276749}
#trust-badge.warn{background:#fffaf0;border-color:#fbd38d;color:#c05621}
#trust-badge.hidden{display:none}

/* STATS */
.stats-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px}
.stat-card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);padding:10px 8px;text-align:center;box-shadow:var(--shadow)}
.stat-num{font-family:var(--mono);font-size:22px;font-weight:700;color:#1d4ed8;line-height:1}
.stat-lbl{font-size:9px;color:var(--ink3);text-transform:uppercase;letter-spacing:1px;margin-top:3px;font-weight:600}
.stat-sub{font-family:var(--mono);font-size:8px;color:var(--border-strong);margin-top:1px}

/* RATE BAR */
.rate-wrap{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);padding:10px 14px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;box-shadow:var(--shadow)}
.rate-label{font-family:var(--mono);font-size:11px;color:var(--ink2)}
.rate-label strong{color:var(--brand)}
.rate-dots{display:flex;gap:3px}
.rdot{width:7px;height:7px;border-radius:50%;background:var(--brand)}
.rdot.used{background:var(--border)}
.rate-warn{background:#fff5f5;border:1.5px solid #feb2b2;border-radius:var(--radius);padding:8px 14px;font-family:var(--mono);font-size:11px;color:#9b2335;text-align:center;margin-bottom:8px;display:none}
.rate-warn.show{display:block}

/* INPUT CARD */
.card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);padding:16px;margin-bottom:10px;box-shadow:var(--shadow)}
.lang-row{display:flex;gap:6px;margin-bottom:14px}
.lang-btn{flex:1;padding:7px;background:transparent;border:1.5px solid var(--border);border-radius:6px;color:var(--ink3);font-family:var(--mono);font-size:11px;cursor:pointer;transition:all .2s;font-weight:700}
.lang-btn.active{background:var(--ink);border-color:var(--ink);color:#fff}
.field-lbl{font-family:var(--mono);font-size:9px;color:var(--ink3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:5px;font-weight:700}
select{width:100%;padding:9px 12px;background:var(--surface2);border:1.5px solid var(--border);border-radius:6px;color:var(--ink);font-family:var(--sans);font-size:13px;margin-bottom:12px;outline:none;appearance:none;cursor:pointer;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%231a1714' d='M5 6L0 0h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;font-weight:500}
select:focus{border-color:var(--ink)}
select option{background:#fff;color:var(--ink)}
textarea{width:100%;height:110px;padding:11px;background:var(--surface2);border:1.5px solid var(--border);border-radius:6px;color:var(--ink);font-family:var(--mono);font-size:12px;resize:none;outline:none;line-height:1.65;transition:border-color .2s}
textarea:focus{border-color:var(--ink);background:#fff}
textarea::placeholder{color:var(--border-strong)}
.char-row{display:flex;justify-content:space-between;align-items:center;margin-top:5px;margin-bottom:12px}
.clear-btn{background:#eff6ff;border:1.5px solid #1d4ed8;color:#1d4ed8;padding:4px 10px;border-radius:5px;font-size:10px;font-family:var(--mono);cursor:pointer;transition:all .2s;font-weight:700}
.clear-btn:hover{border-color:#1e40af;color:#1e40af;background:#dbeafe}
.char-count{font-family:var(--mono);font-size:10px;color:var(--ink3)}

/* ANALYZE BUTTON */
#analyze-btn{width:100%;padding:14px;background:var(--brand);border:none;border-radius:8px;color:#fff;font-family:var(--mono);font-weight:700;font-size:14px;letter-spacing:.5px;cursor:pointer;transition:all .2s;box-shadow:0 2px 8px rgba(29,78,216,.3);position:relative;overflow:hidden}
#analyze-btn:hover:not(:disabled){background:var(--brand2);transform:translateY(-1px);box-shadow:0 4px 16px rgba(29,78,216,.35)}
#analyze-btn:disabled{opacity:.45;cursor:not-allowed;transform:none}
#analyze-btn.loading::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);animation:shimmer 1s infinite}
@keyframes shimmer{to{left:100%}}
.trust-pills{display:flex;justify-content:center;gap:10px;margin-top:8px;flex-wrap:wrap}
.tpill{font-family:var(--mono);font-size:9px;color:var(--ink3);display:flex;align-items:center;gap:3px}
.tpill::before{content:'‚úì';color:#1d4ed8;font-weight:700}

/* RESULT CARD */
#result-card{display:none;border-radius:var(--radius);overflow:hidden;margin-bottom:10px;border:1.5px solid var(--border);box-shadow:var(--shadow-lg);animation:slideIn .25s ease}
@keyframes slideIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* VERDICT HEADER */
.verdict-header{padding:16px;display:flex;align-items:flex-start;gap:13px}
.verdict-icon{width:46px;height:46px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;border:2px solid;font-family:var(--mono);font-weight:700}
.verdict-main{flex:1;min-width:0}
.verdict-name{font-family:var(--mono);font-size:18px;font-weight:700;line-height:1.1}
.verdict-sub{font-size:12px;margin-top:3px;font-weight:500}
.verdict-code{font-family:var(--mono);font-size:9px;margin-top:4px;opacity:.6}

/* HASHCHAIN STRIP ‚Äî ALWAYS VISIBLE ‚úÖ */
.hash-strip{display:flex;align-items:center;gap:8px;padding:12px 16px;border-top:2px solid #9ae6b4;border-bottom:2px solid #9ae6b4;background:#f0fff4}
.hash-verified-badge{display:flex;align-items:center;gap:5px;flex:1;min-width:0}
.hash-check{font-size:20px;flex-shrink:0}
.hash-texts{min-width:0}
.hash-title{font-family:var(--mono);font-size:12px;font-weight:700;color:#276749;letter-spacing:.3px}
.hash-val{font-family:var(--mono);font-size:9px;color:var(--ink3);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-top:1px}
.hash-actions{display:flex;gap:5px;flex-shrink:0}
.hash-btn{padding:3px 9px;background:transparent;border:1.5px solid var(--border);border-radius:5px;font-family:var(--mono);font-size:9px;color:var(--ink2);cursor:pointer;transition:all .2s;font-weight:700}
.hash-btn:hover{border-color:var(--ink);color:var(--ink)}

/* RESULT DISCLAIMER */
.result-disc{padding:9px 16px;font-family:var(--mono);font-size:10px;border-bottom:1px solid var(--border)}

/* SUMMARY */
.summary{padding:13px 16px;font-size:13px;line-height:1.6;font-weight:500;border-bottom:1px solid var(--border)}

/* SIGNAL BREAKDOWN ‚Äî NEW: shows P/M/A/X/C */
.signals-wrap{padding:12px 16px;border-bottom:1px solid var(--border);background:var(--surface)}
.signals-title{font-family:var(--mono);font-size:9px;text-transform:uppercase;letter-spacing:1.5px;color:var(--ink3);margin-bottom:8px;font-weight:700}
.signals-grid{display:flex;gap:6px;flex-wrap:wrap}
.signal-chip{display:inline-flex;align-items:center;gap:5px;padding:5px 10px;border-radius:6px;font-family:var(--mono);font-size:10px;border:1.5px solid;font-weight:700}
.signal-chip.active-chip{background:var(--v3bg);border-color:var(--v3border);color:var(--v3)}
.signal-chip.inactive-chip{background:var(--surface2);border-color:var(--border);color:var(--ink3)}
.signal-def{font-size:9px;color:var(--ink3);margin-top:6px;line-height:1.5;font-family:var(--mono)}

/* CONFIDENCE */
.conf-wrap{padding:12px 16px;border-bottom:1px solid var(--border)}
.conf-top{display:flex;justify-content:space-between;align-items:center;font-family:var(--mono);font-size:10px;color:var(--ink2);margin-bottom:6px;font-weight:700}
.conf-pct{font-size:16px;font-weight:700}
.conf-track{height:8px;background:var(--bg2);border-radius:4px;overflow:hidden;border:1px solid var(--border)}
.conf-fill{height:100%;border-radius:4px;width:0%;transition:width .8s cubic-bezier(.4,0,.2,1)}
.conf-band{font-family:var(--mono);font-size:9px;margin-top:5px;font-weight:700}
.conf-note{font-size:10px;color:var(--ink3);margin-top:3px;line-height:1.5}

/* TRIGGERED RULES */
.rules-wrap{padding:12px 16px;border-bottom:1px solid var(--border)}
.section-hdr{font-family:var(--mono);font-size:9px;text-transform:uppercase;letter-spacing:1.5px;color:var(--ink3);margin-bottom:7px;font-weight:700;display:flex;align-items:center;gap:6px;cursor:pointer;user-select:none}
.caret{font-size:8px;transition:transform .2s;display:inline-block}
.caret.open{transform:rotate(90deg)}
.rules-body{display:none;flex-wrap:wrap;gap:5px}
.rules-body.open{display:flex}
.rule-tag{padding:4px 10px;border-radius:5px;font-family:var(--mono);font-size:10px;border:1.5px solid;font-weight:700}

/* TRACE */
.trace-wrap{padding:12px 16px;border-bottom:1px solid var(--border)}
.trace-note{font-family:var(--mono);font-size:9px;color:var(--ink3);margin-bottom:6px}
.trace-body{display:none}
.trace-body.open{display:block}
.trace-row{display:flex;justify-content:space-between;font-family:var(--mono);font-size:10px;padding:4px 0;border-bottom:1px solid var(--border);color:var(--ink2)}
.trace-val{color:#1d4ed8;font-weight:700}

/* ACTIONS */
.actions-wrap{padding:12px 16px;border-bottom:1px solid var(--border)}
.action-btns{display:flex;gap:8px}
.act-btn{flex:1;padding:10px;border-radius:7px;font-family:var(--mono);font-size:11px;cursor:pointer;transition:all .2s;font-weight:700;letter-spacing:.3px}
.btn-share{background:var(--brand);border:none;color:#fff}
.btn-share:hover{background:var(--brand2)}
.btn-copy{background:transparent;border:1.5px solid var(--border-strong);color:var(--ink2)}
.btn-copy:hover{border-color:var(--ink);color:var(--ink);background:var(--surface2)}
.action-note{font-family:var(--mono);font-size:9px;color:var(--ink3);text-align:center;margin-top:6px}

/* SAFE NOTICE */
.safe-notice{padding:10px 16px;background:var(--surface2);font-size:11px;color:var(--ink3);line-height:1.6;border-bottom:1px solid var(--border)}

/* FEEDBACK */
.fb-wrap{padding:11px 16px;display:flex;align-items:center;gap:10px;flex-wrap:wrap;background:var(--surface)}
.fb-lbl{font-family:var(--mono);font-size:10px;color:var(--ink3);font-weight:700}
.fb-btn{padding:5px 13px;background:transparent;border:1.5px solid var(--border);border-radius:20px;font-size:11px;color:var(--ink3);cursor:pointer;font-family:var(--mono);transition:all .2s;font-weight:700}
.fb-btn.sel{background:var(--ink);border-color:var(--ink);color:#fff}
.fb-btn:disabled{opacity:.5;cursor:not-allowed}
.fb-thanks{font-family:var(--mono);font-size:10px;color:#276749;display:none;font-weight:700}
.fb-thanks.show{display:inline}
.fb-once{font-family:var(--mono);font-size:9px;color:var(--border-strong);width:100%;margin-top:2px}

/* EXAMPLES */
.examples-card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:10px;box-shadow:var(--shadow)}
.sec-title{font-family:var(--mono);font-size:9px;color:var(--ink3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:4px;font-weight:700}
.sec-sub{font-family:var(--mono);font-size:9px;color:var(--border-strong);margin-bottom:10px}
.ex-btns{display:flex;flex-direction:column;gap:6px}
.ex-btn{width:100%;padding:9px 12px;background:var(--surface2);border:1.5px solid var(--border);border-radius:7px;color:var(--ink2);font-family:var(--mono);font-size:11px;cursor:pointer;text-align:left;transition:all .2s;font-weight:700}
.ex-btn:hover{border-color:var(--ink);color:var(--ink);background:#fff}

/* DISCLAIMER */
.disc-card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-bottom:10px;box-shadow:var(--shadow)}
.disc-title{font-family:var(--mono);font-size:9px;color:#1d4ed8;letter-spacing:1.5px;text-transform:uppercase;margin-bottom:6px;font-weight:700}
.disc-body{font-size:12px;color:var(--ink2);line-height:1.7}

/* HOW IT WORKS */
.how-card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);padding:14px 16px;margin-bottom:10px;box-shadow:var(--shadow)}
.how-list{margin-top:10px;display:flex;flex-direction:column;gap:7px}
.how-item{display:flex;align-items:flex-start;gap:8px;font-size:12px;color:var(--ink2);line-height:1.5}
.how-item::before{content:'‚óÜ';color:#1d4ed8;font-size:8px;flex-shrink:0;margin-top:3px}

/* TRUST FOOTER */
.trust-footer{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);padding:13px 16px;margin-bottom:10px;text-align:center;box-shadow:var(--shadow)}
.tf1{font-family:var(--mono);font-size:11px;color:var(--ink);font-weight:700;margin-bottom:3px}
.tf1 span{color:#1d4ed8}
.tf2{font-size:11px;color:var(--ink3)}

footer{text-align:center;font-family:var(--mono);font-size:9px;color:var(--border-strong);padding:12px 0 8px;line-height:2}

/* TOAST */
#toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:var(--ink);border-radius:7px;padding:8px 18px;font-family:var(--mono);font-size:12px;color:#fff;z-index:300;opacity:0;transition:opacity .3s;pointer-events:none;white-space:nowrap;font-weight:700;box-shadow:var(--shadow-lg)}
#toast.show{opacity:1}

/* MODALS */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(26,23,20,.7);z-index:200;align-items:center;justify-content:center;padding:20px}
.modal-overlay.show{display:flex}
.modal-box{background:#fff;border:1.5px solid var(--border);border-radius:14px;padding:28px;max-width:340px;width:100%;text-align:center;box-shadow:var(--shadow-lg)}
.modal-icon{font-size:36px;margin-bottom:10px}
.modal-title{font-family:var(--mono);font-size:16px;font-weight:700;color:var(--ink);margin-bottom:8px}
.modal-text{font-family:var(--mono);font-size:11px;color:var(--ink3);line-height:1.8;margin-bottom:16px}
.modal-close{padding:10px 24px;background:var(--brand);border:none;border-radius:7px;color:#fff;font-family:var(--mono);font-weight:700;font-size:12px;cursor:pointer}

/* VERDICT COLOR CLASSES */
.v0-header{background:var(--v0bg);border-bottom:1px solid var(--v0border)}
.v0-icon{border-color:var(--v0border);color:var(--v0);background:var(--v0bg)}
.v0-name{color:var(--v0)}
.v0-disc{background:#edf2f7;border-color:var(--v0border);color:var(--v0)}
.v0-fill{background:var(--v0)}
.v0-band{color:var(--v0)}
.v0-tag{background:var(--v0bg);border-color:var(--v0border);color:var(--v0)}

.v1-header{background:var(--v1bg);border-bottom:1px solid var(--v1border)}
.v1-icon{border-color:var(--v1border);color:var(--v1);background:var(--v1bg)}
.v1-name{color:var(--v1)}
.v1-disc{background:#f0fff4;border-color:var(--v1border);color:var(--v1)}
.v1-fill{background:var(--v1)}
.v1-band{color:var(--v1)}
.v1-tag{background:var(--v1bg);border-color:var(--v1border);color:var(--v1)}

.v2-header{background:var(--v2bg);border-bottom:1px solid var(--v2border)}
.v2-icon{border-color:var(--v2border);color:var(--v2);background:var(--v2bg)}
.v2-name{color:var(--v2)}
.v2-disc{background:#fffaf0;border-color:var(--v2border);color:var(--v2)}
.v2-fill{background:var(--v2)}
.v2-band{color:var(--v2)}
.v2-tag{background:var(--v2bg);border-color:var(--v2border);color:var(--v2)}

.v3-header{background:var(--v3bg);border-bottom:1px solid var(--v3border)}
.v3-icon{border-color:var(--v3border);color:var(--v3);background:var(--v3bg)}
.v3-name{color:var(--v3)}
.v3-disc{background:#fff5f5;border-color:var(--v3border);color:var(--v3)}
.v3-fill{background:var(--v3)}
.v3-band{color:var(--v3)}
.v3-tag{background:var(--v3bg);border-color:var(--v3border);color:var(--v3)}

/* IMAGE UPLOAD */
.img-upload-row{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.img-upload-btn{display:inline-flex;align-items:center;gap:6px;padding:7px 14px;background:#eff6ff;border:1.5px dashed #1d4ed8;border-radius:6px;color:#1d4ed8;font-family:var(--mono);font-size:11px;cursor:pointer;transition:all .2s;font-weight:700}
.img-upload-btn:hover{background:#dbeafe;border-style:solid}
.img-upload-btn input{display:none}
.img-upload-row{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}
.img-preview-wrap{display:none;margin-bottom:8px;border-radius:6px;overflow:hidden;border:1.5px solid #1d4ed8;max-height:80px;position:relative}
.img-preview-wrap.show{display:flex;align-items:center;gap:8px;padding:6px 10px;background:#eff6ff;max-height:none;flex-wrap:wrap}
.img-thumb{width:52px;height:52px;object-fit:cover;border-radius:4px;border:1px solid #1d4ed8;flex-shrink:0}
.img-info{flex:1;min-width:0}
.img-filename{font-family:var(--mono);font-size:10px;color:#1d4ed8;font-weight:700;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.img-clear-btn{background:transparent;border:1.5px solid #1d4ed8;color:#1d4ed8;border-radius:4px;padding:3px 8px;font-family:var(--mono);font-size:10px;cursor:pointer;font-weight:700;flex-shrink:0}
.img-clear-btn:hover{background:#dbeafe}
.img-status{font-family:var(--mono);font-size:10px;font-weight:700}
.img-status.ok{color:#276749}
.img-status.warn{color:#c05621}
.img-processing{display:none;font-family:var(--mono);font-size:10px;color:var(--ink3);align-items:center;gap:5px}
.img-processing.show{display:flex}
.progress-bar-wrap{width:100%;height:4px;background:var(--border);border-radius:2px;margin-top:4px;overflow:hidden}
.progress-bar-fill{height:100%;background:#1d4ed8;border-radius:2px;width:0%;transition:width .3s}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div id="warn-bar">
  <span id="warn-text">‚ö† This tool analyzes text for known risk patterns only. It does NOT confirm fraud. Low risk does NOT mean safe. Final responsibility remains with the user. ¬∑ ‡§Ø‡§π ‡§ü‡•Ç‡§≤ ‡§ï‡•á‡§µ‡§≤ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§¶‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à ‚Äî ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§</span>
</div>

<div id="app">

  <!-- HEADER -->
  <div class="header">
    <div class="logo-row">
      <div class="logo-icon">üõ°</div>
      <div class="logo-name">Veritas Guard</div>
    </div>
    <div class="tagline" id="tagline-text">DETERMINISTIC RISK SIGNALS ¬∑ NO GUESSING</div>
    <div>
      <div class="engine-pill checking" id="engine-pill" onclick="showInfoModal()">
        <div class="dot"></div>
        <span id="engine-pill-text">ENGINE ‚Äî CHECKING...</span>
      </div>
    </div>
    <div>
      <div id="trust-badge" class="hidden">üîí <span id="trust-badge-text">Rules Hard-Locked ¬∑ ...</span></div>
    </div>
  </div>

  <!-- STATS -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-num" id="stat-total">0</div>
      <div class="stat-lbl" id="lbl-total">Total Scans</div>
      <div class="stat-sub">Session</div>
    </div>
    <div class="stat-card">
      <div class="stat-num" id="stat-today">0</div>
      <div class="stat-lbl" id="lbl-today">Today</div>
      <div class="stat-sub">Resets midnight</div>
    </div>
    <div class="stat-card">
      <div class="stat-num" id="stat-flagged">0</div>
      <div class="stat-lbl">Flagged</div>
      <div class="stat-sub">Risk found</div>
    </div>
  </div>

  <!-- RATE BAR -->
  <div class="rate-wrap">
    <div class="rate-label" id="rate-label">Remaining: <strong id="rate-num">10</strong>/10</div>
    <div class="rate-dots" id="rate-dots"></div>
  </div>
  <div class="rate-warn" id="rate-warn">Daily limit reached. Try again later.</div>

  <!-- INPUT CARD -->
  <div class="card">
    <div class="lang-row">
      <button class="lang-btn active" id="btn-en" onclick="setLang('en')">EN</button>
      <button class="lang-btn" id="btn-hi" onclick="setLang('hi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
    </div>
    <div class="field-lbl" id="lbl-usecase">USE CASE</div>
    <select id="usecase">
      <option value="cyber"      data-en="Cyber / Fraud"        data-hi="‡§∏‡§æ‡§á‡§¨‡§∞ / ‡§´‡•ç‡§∞‡•â‡§°">Cyber / Fraud</option>
      <option value="banking"    data-en="Banking / Fintech"     data-hi="‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó / ‡§´‡§ø‡§®‡§ü‡•á‡§ï">Banking / Fintech</option>
      <option value="legal"      data-en="Legal / Compliance"    data-hi="‡§ï‡§æ‡§®‡•Ç‡§®‡•Ä / ‡§Ö‡§®‡•Å‡§™‡§æ‡§≤‡§®">Legal / Compliance</option>
      <option value="health"     data-en="Healthcare"            data-hi="‡§π‡•á‡§≤‡•ç‡§•‡§ï‡•á‡§Ø‡§∞">Healthcare</option>
      <option value="insurance"  data-en="Insurance"             data-hi="‡§¨‡•Ä‡§Æ‡§æ">Insurance</option>
      <option value="govt"       data-en="Government / Public"   data-hi="‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä / ‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï">Government / Public</option>
      <option value="ecom"       data-en="E-commerce"            data-hi="‡§à-‡§ï‡•â‡§Æ‡§∞‡•ç‡§∏">E-commerce</option>
      <option value="edu"        data-en="Education / Research"  data-hi="‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ / ‡§Ö‡§®‡•Å‡§∏‡§Ç‡§ß‡§æ‡§®">Education / Research</option>
      <option value="enterprise" data-en="Enterprise Security"   data-hi="‡§è‡§Ç‡§ü‡§∞‡§™‡•ç‡§∞‡§æ‡§á‡§ú ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ">Enterprise Security</option>
    </select>
    <div class="field-lbl" id="lbl-input">MESSAGE / SMS / LINK</div>
    <!-- IMAGE UPLOAD -->
    <div class="img-upload-row">
      <label class="img-upload-btn">
        üì∑ <span id="img-btn-text">Upload Screenshot</span>
        <input type="file" id="img-input" accept="image/*" onchange="handleImage(event)">
      </label>
      <span class="img-status" id="img-status"></span>
      <span class="img-processing" id="img-processing"><span id="img-proc-text">‚ü≥ Reading image...</span></span>
    </div>
    <div class="img-preview-wrap" id="img-preview-wrap">
      <img class="img-thumb" id="img-preview" src="" alt="">
      <div class="img-info">
        <div class="img-filename" id="img-filename">screenshot.jpg</div>
        <div class="progress-bar-wrap"><div class="progress-bar-fill" id="prog-bar"></div></div>
      </div>
      <button class="img-clear-btn" onclick="clearImage()">‚úï</button>
    </div>
    <textarea id="input-text" maxlength="1000" placeholder="Paste SMS, WhatsApp message, or link here..."></textarea>
    <div class="char-row">
      <button class="clear-btn" id="clear-btn">‚úï CLEAR</button>
      <span class="char-count"><span id="char-val">0</span>/1000</span>
    </div>
    <button id="analyze-btn" onclick="doAnalyze()">
      <span id="btn-text">‚ö° ANALYZE RISK SIGNALS</span>
    </button>
    <div class="trust-pills">
      <span class="tpill" id="nd1">No Login</span>
      <span class="tpill" id="nd2">No Storage</span>
      <span class="tpill" id="nd3">Deterministic Rules</span>
    </div>
  </div>

  <!-- RESULT CARD -->
  <div id="result-card"></div>

  <!-- EXAMPLES -->
  <div class="examples-card">
    <div class="sec-title" id="ex-title">TRY AN EXAMPLE</div>
    <div class="sec-sub" id="ex-sub">Examples are simulated messages</div>
    <div class="ex-btns">
      <button class="ex-btn" id="ex1" onclick="loadEx(0)">üö® Try scam example</button>
      <button class="ex-btn" id="ex2" onclick="loadEx(1)">üè¶ Try bank SMS example</button>
      <button class="ex-btn" id="ex3" onclick="loadEx(2)">üèõ Try government advisory example</button>
    </div>
  </div>

  <!-- DISCLAIMER -->
  <div class="disc-card">
    <div class="disc-title" id="disc-title">‚ö† DISCLAIMER</div>
    <p class="disc-body" id="disc-body">This tool analyzes messages for known risk patterns only. It does not confirm fraud. Low risk does NOT mean safe. Final responsibility remains with the user.</p>
  </div>

  <!-- HOW IT WORKS -->
  <div class="how-card">
    <div class="sec-title" id="how-title">HOW THIS WORKS</div>
    <div class="how-list">
      <div class="how-item" id="how1">No login required</div>
      <div class="how-item" id="how2">No message content stored</div>
      <div class="how-item" id="how3">Deterministic rules ‚Äî no guessing, no prediction</div>
      <div class="how-item" id="how4">Hash-sealed engine ‚Äî rules cannot change without re-seal</div>
    </div>
  </div>

  <!-- TRUST FOOTER -->
  <div class="trust-footer">
    <div class="tf1">ENGINE <span id="footer-ver">v1.5</span> ¬∑ STATUS: <span>RULES FROZEN</span></div>
    <div class="tf2">Deterministic engine ¬∑ No guessing ¬∑ No message storage</div>
  </div>

  <footer>¬© Veritas Engine ‚Äî Open Risk Awareness Tool</footer>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- INFO MODAL -->
<div class="modal-overlay" id="info-modal">
  <div class="modal-box">
    <div class="modal-icon">üõ°</div>
    <div class="modal-title">About Veritas Guard</div>
    <div class="modal-text" id="info-modal-text">
      Veritas Guard analyzes text for known risk patterns using deterministic rules.<br><br>
      It does NOT block, verify, report, or guarantee anything.<br><br>
      Low risk does NOT mean safe.<br><br>
      Powered by deterministic pattern rules ‚Äî not AI.
    </div>
    <button class="modal-close" onclick="closeModal('info-modal')">UNDERSTOOD</button>
  </div>
</div>

<!-- HASHCHAIN MODAL -->
<div class="modal-overlay" id="hash-modal">
  <div class="modal-box">
    <div class="modal-icon">üîí</div>
    <div class="modal-title">Hashchain Verified</div>
    <div class="modal-text">
      Result is hash-sealed. Engine rules cannot change without re-seal.<br><br>
      This ensures the engine that ran is exactly the version shown.<br><br>
      You can share this result as cryptographic proof.
    </div>
    <button class="modal-close" onclick="closeModal('hash-modal')">UNDERSTOOD</button>
  </div>
</div>

<!-- LIMIT MODAL -->
<div class="modal-overlay" id="limit-modal">
  <div class="modal-box">
    <div class="modal-icon">‚è≥</div>
    <div class="modal-title" id="limit-title">Daily Limit Reached</div>
    <div class="modal-text" id="limit-text">You have used all 10 analyses for today.<br>Please try again after 24 hours.</div>
    <button class="modal-close" onclick="closeModal('limit-modal')">OK</button>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CONFIG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const ENGINE_BASE = "https://api.veritasengine.in";
const DAILY_LIMIT = 10;
const DEV_CODE    = "VERITAS-DEV-2026";

const EXAMPLES = [
  "Congratulations! You won Rs.5,00,000 lottery. Pay Rs.2,500 processing fee to claim. Visit: bit.ly/claim-now",
  "Sent Rs.1,250 from HDFC Bank A/c XX1234 to Amazon Pay. UPI Ref 9837264512. Not you? Call 1800-XXX-XXXX",
  "Important advisory from Ministry of Finance: Be aware of fake calls posing as income tax officials. Visit incometax.gov.in only."
];

/* ‚ïê‚ïê SIGNAL EXPLANATIONS ‚Äî P/M/A/X/C ‚ïê‚ïê */
const SIGNAL_META = {
  P:{ label:'P ‚Äî Phishing',    en:'Impersonation / identity fraud keywords', hi:'‡§™‡§π‡§ö‡§æ‡§® ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§∏‡§Ç‡§ï‡•á‡§§' },
  M:{ label:'M ‚Äî Money',       en:'Monetary request or reward signal',        hi:'‡§™‡•à‡§∏‡•á ‡§ï‡•Ä ‡§Æ‡§æ‡§Ç‡§ó ‡§Ø‡§æ ‡§á‡§®‡§æ‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§' },
  A:{ label:'A ‚Äî Amount',      en:'Specific amount pattern detected',         hi:'‡§∞‡§æ‡§∂‡§ø ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡§æ' },
  X:{ label:'X ‚Äî External',    en:'Suspicious external link detected',        hi:'‡§∏‡§Ç‡§¶‡§ø‡§ó‡•ç‡§ß ‡§¨‡§æ‡§π‡§∞‡•Ä ‡§≤‡§ø‡§Ç‡§ï' },
  C:{ label:'C ‚Äî Call-to-Act', en:'Urgency / action demand detected',         hi:'‡§§‡§§‡•ç‡§ï‡§æ‡§≤‡§§‡§æ / ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§ï‡•Ä ‡§Æ‡§æ‡§Ç‡§ó' }
};

/* ‚ïê‚ïê DECISION MAP ‚Äî engine v1.5 ‚ïê‚ïê
   0=NORMAL 1=ATTENTION 2=SUSPECT 3=HIGH_RISK
‚ïê‚ïê */
const DM = {
  en:{
    label:  ['No Pattern Detected','Attention Required','Suspicious Patterns Found','High Risk ‚Äî Likely Scam'],
    sub:    ['No known risk signals in this message','Weak or partial risk signals detected','Multiple risk patterns detected','Strong, confirmed fraud pattern signals'],
    code:   ['DECISION 0 ¬∑ NORMAL','DECISION 1 ¬∑ ATTENTION','DECISION 2 ¬∑ SUSPECT','DECISION 3 ¬∑ HIGH_RISK'],
    range:  ['Signal 0‚Äì20%','Signal 20‚Äì45%','Signal 45‚Äì75%','Signal 75‚Äì100%'],
    emoji:  ['‚Äî','!','‚ö†','‚úñ'],
    disc:   [
      'No patterns found. This does NOT mean the message is safe.',
      'Weak signals detected. Verify sender before any action.',
      'Multiple risk patterns found. Do not click links or share details.',
      'Strong scam signals. Do not proceed, share details, or make payments.'
    ],
    summary:[
      'No known risk patterns were found. This does NOT guarantee the message is legitimate.',
      'Weak risk indicators detected. Verify the sender before taking any action.',
      'Multiple risk patterns detected. Do not click any links or share personal details.',
      'Strong scam indicators detected. Do not proceed, share details, or make payments.'
    ],
    bands:[
      {max:20, label:'Very low signal ‚Äî no strong patterns matched'},
      {max:45, label:'Weak signal ‚Äî partial patterns matched'},
      {max:75, label:'Moderate signal ‚Äî multiple patterns matched'},
      {max:101,label:'Strong signal ‚Äî high-risk patterns confirmed'}
    ],
    confNote:'Confidence = pattern match strength only. Does NOT confirm fraud or guarantee safety.',
    noRules:'No specific patterns triggered',
    ruleHdr:'TRIGGERED RULES',traceHdr:'TRACE (Auditors)',traceNote:'Technical signal breakdown ‚Äî for advanced users',
    hashTitle:'‚úÖ Hashchain Verified',hashCopy:'Copy Hash',hashLearn:'Learn more',hashCopied:'Verification hash copied',
    safeNotice:'Genuine messages can sometimes match risk patterns. This engine does not guarantee legitimacy.',
    disc:'This engine does not confirm safety or fraud. Results are pattern-based only.',
    fbLbl:'Was this helpful?',fbYes:'Helpful',fbNo:'Not Helpful',
    fbThanks:'Thanks. Feedback recorded (anonymous).',fbOnce:'One feedback per result.',
    share:'SHARE',copy:'COPY PROOF',actNote:'Shares verdict, confidence % & proof hash',
    toastCopy:'Proof copied ‚úì',toastHash:'Hash copied ‚úì',noRulesTag:'No patterns triggered'
  },
  hi:{
    label:  ['‡§ï‡•ã‡§à ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç','‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç','‡§∏‡§Ç‡§¶‡§ø‡§ó‡•ç‡§ß ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á','‡§â‡§ö‡•ç‡§ö ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‚Äî ‡§∏‡§Ç‡§≠‡§æ‡§µ‡§ø‡§§ ‡§∏‡•ç‡§ï‡•à‡§Æ'],
    sub:    ['‡§á‡§∏ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§®‡§π‡•Ä‡§Ç','‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§Ø‡§æ ‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§','‡§ï‡§à ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á','‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§™‡•Å‡§∑‡•ç‡§ü ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§∏‡§Ç‡§ï‡•á‡§§'],
    code:   ['‡§®‡§ø‡§∞‡•ç‡§£‡§Ø 0 ¬∑ ‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø','‡§®‡§ø‡§∞‡•ç‡§£‡§Ø 1 ¬∑ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç','‡§®‡§ø‡§∞‡•ç‡§£‡§Ø 2 ¬∑ ‡§∏‡§Ç‡§¶‡§ø‡§ó‡•ç‡§ß','‡§®‡§ø‡§∞‡•ç‡§£‡§Ø 3 ¬∑ ‡§â‡§ö‡•ç‡§ö ‡§ú‡•ã‡§ñ‡§ø‡§Æ'],
    range:  ['‡§∏‡§Ç‡§ï‡•á‡§§ 0‚Äì20%','‡§∏‡§Ç‡§ï‡•á‡§§ 20‚Äì45%','‡§∏‡§Ç‡§ï‡•á‡§§ 45‚Äì75%','‡§∏‡§Ç‡§ï‡•á‡§§ 75‚Äì100%'],
    emoji:  ['‚Äî','!','‚ö†','‚úñ'],
    disc:   [
      '‡§ï‡•ã‡§à ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§á‡§∏‡§ï‡§æ ‡§Ö‡§∞‡•ç‡§• ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§',
      '‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§ï‡•ã‡§à ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç‡•§',
      '‡§ï‡§à ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§',
      '‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§∏‡•ç‡§ï‡•à‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§‡•§ ‡§Ü‡§ó‡•á ‡§® ‡§¨‡§¢‡§º‡•á‡§Ç‡•§'
    ],
    summary:[
      '‡§ï‡•ã‡§à ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§Ø‡§π ‡§µ‡•à‡§ß‡§§‡§æ ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§',
      '‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§™‡•ç‡§∞‡•á‡§∑‡§ï ‡§ï‡•Ä ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§∞‡•á‡§Ç‡•§',
      '‡§ï‡§à ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§ï‡•ã‡§à ‡§≤‡§ø‡§Ç‡§ï ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§® ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡§æ‡§ù‡§æ ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§',
      '‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§∏‡•ç‡§ï‡•à‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§Ü‡§ó‡•á ‡§® ‡§¨‡§¢‡§º‡•á‡§Ç, ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡§æ‡§ù‡§æ ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§'
    ],
    bands:[
      {max:20, label:'‡§¨‡§π‡•Å‡§§ ‡§ï‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‚Äî ‡§ï‡•ã‡§à ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç'},
      {max:45, label:'‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§∏‡§Ç‡§ï‡•á‡§§ ‚Äî ‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á'},
      {max:75, label:'‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‚Äî ‡§ï‡§à ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á'},
      {max:101,label:'‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§∏‡§Ç‡§ï‡•á‡§§ ‚Äî ‡§â‡§ö‡•ç‡§ö ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø'}
    ],
    confNote:'‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§∏‡•ç‡§ï‡•ã‡§∞ = ‡§ï‡•á‡§µ‡§≤ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡§æ‡§®‡•§ ‡§Ø‡§π ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§',
    noRules:'‡§ï‡•ã‡§à ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ',
    ruleHdr:'‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§®‡§ø‡§Ø‡§Æ',traceHdr:'‡§ü‡•ç‡§∞‡•á‡§∏ (‡§ë‡§°‡§ø‡§ü‡§∞)',traceNote:'‡§§‡§ï‡§®‡•Ä‡§ï‡•Ä ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§µ‡§ø‡§µ‡§∞‡§£ ‚Äî ‡§â‡§®‡•ç‡§®‡§§ ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ‡§ì‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è',
    hashTitle:'‚úÖ ‡§π‡•à‡§∂‡§ö‡•á‡§® ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§',hashCopy:'‡§π‡•à‡§∂ ‡§ï‡•â‡§™‡•Ä',hashLearn:'‡§î‡§∞ ‡§ú‡§æ‡§®‡•á‡§Ç',hashCopied:'‡§π‡•à‡§∂ ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ',
    safeNotice:'‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§≠‡•Ä ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§∏‡•á ‡§Æ‡•á‡§≤ ‡§ñ‡§æ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§ ‡§Ø‡§π ‡§á‡§Ç‡§ú‡§® ‡§µ‡•à‡§ß‡§§‡§æ ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡§æ‡•§',
    disc:'‡§Ø‡§π ‡§á‡§Ç‡§ú‡§® ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§Ø‡§æ ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡§æ‡•§ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§®-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§π‡•à‡§Ç‡•§',
    fbLbl:'‡§ï‡•ç‡§Ø‡§æ ‡§Ø‡§π ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§•‡§æ?',fbYes:'‡§∏‡§π‡§æ‡§Ø‡§ï',fbNo:'‡§∏‡§π‡§æ‡§Ø‡§ï ‡§®‡§π‡•Ä‡§Ç',
    fbThanks:'‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§ ‡§´‡•Ä‡§°‡§¨‡•à‡§ï ‡§¶‡§∞‡•ç‡§ú‡•§',fbOnce:'‡§™‡•ç‡§∞‡§§‡§ø ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§è‡§ï ‡§´‡•Ä‡§°‡§¨‡•à‡§ï‡•§',
    share:'‡§∂‡•á‡§Ø‡§∞',copy:'‡§™‡•ç‡§∞‡•Ç‡§´ ‡§ï‡•â‡§™‡•Ä',actNote:'‡§®‡§ø‡§∞‡•ç‡§£‡§Ø, ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ % ‡§î‡§∞ ‡§™‡•ç‡§∞‡•Ç‡§´ ‡§π‡•à‡§∂ ‡§∂‡•á‡§Ø‡§∞ ‡§π‡•ã‡§ó‡§æ',
    toastCopy:'‡§™‡•ç‡§∞‡•Ç‡§´ ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ ‚úì',toastHash:'‡§π‡•à‡§∂ ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ ‚úì',noRulesTag:'‡§ï‡•ã‡§à ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ'
  }
};

const TXT = {
  en:{
    tagline:'DETERMINISTIC RISK SIGNALS ¬∑ NO GUESSING',
    lblUsecase:'USE CASE',lblInput:'MESSAGE / SMS / LINK',
    placeholder:'Paste SMS, WhatsApp message, or link here...',
    btnText:'‚ö° ANALYZE RISK SIGNALS',analyzing:'ANALYZING...',
    nd1:'No Login',nd2:'No Storage',nd3:'Deterministic Rules',
    lblTotal:'Total Scans',lblToday:'Today',
    rateText:'Remaining:',rateWarn:'Daily limit reached. Try again later.',
    discTitle:'‚ö† DISCLAIMER',
    discBody:'This tool analyzes messages for known risk patterns only. It does not confirm fraud. Low risk does NOT mean safe. Final responsibility remains with the user.',
    howTitle:'HOW THIS WORKS',
    how1:'No login required',how2:'No message content stored',
    how3:'Deterministic rules ‚Äî no guessing, no prediction',
    how4:'Hash-sealed engine ‚Äî rules cannot change without re-seal',
    exTitle:'TRY AN EXAMPLE',exSub:'Examples are simulated messages',
    ex1:'üö® Try scam example',ex2:'üè¶ Try bank SMS example',ex3:'üèõ Try government advisory example',
    limitTitle:'Daily Limit Reached',limitText:'You have used all 10 analyses for today.<br>Please try again after 24 hours.'
  },
  hi:{
    tagline:'‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ¬∑ ‡§ï‡•ã‡§à ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç',
    lblUsecase:'‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞',lblInput:'‡§∏‡§Ç‡§¶‡•á‡§∂ / SMS / ‡§≤‡§ø‡§Ç‡§ï',
    placeholder:'SMS, WhatsApp ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§æ ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§ö‡§ø‡§™‡§ï‡§æ‡§è‡§Å...',
    btnText:'‚ö° ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç',analyzing:'‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...',
    nd1:'‡§ï‡•ã‡§à ‡§≤‡•â‡§ó‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç',nd2:'‡§ï‡•ã‡§à ‡§∏‡•ç‡§ü‡•ã‡§∞‡•á‡§ú ‡§®‡§π‡•Ä‡§Ç',nd3:'‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§®‡§ø‡§Ø‡§Æ',
    lblTotal:'‡§ï‡•Å‡§≤ ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç',lblToday:'‡§Ü‡§ú',
    rateText:'‡§∂‡•á‡§∑:',rateWarn:'‡§¶‡•à‡§®‡§ø‡§ï ‡§∏‡•Ä‡§Æ‡§æ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§ ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§',
    discTitle:'‚ö† ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§∞‡§£',
    discBody:'‡§Ø‡§π ‡§ü‡•Ç‡§≤ ‡§ï‡•á‡§µ‡§≤ ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡§Ç‡§¶‡•á‡§∂‡•ã‡§Ç ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§ ‡§ï‡§Æ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§',
    howTitle:'‡§Ø‡§π ‡§ï‡•à‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à',
    how1:'‡§ï‡•ã‡§à ‡§≤‡•â‡§ó‡§ø‡§® ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§®‡§π‡•Ä‡§Ç',how2:'‡§ï‡•ã‡§à ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§®‡§π‡•Ä‡§Ç',
    how3:'‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§®‡§ø‡§Ø‡§Æ ‚Äî ‡§ï‡•ã‡§à ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç',
    how4:'‡§π‡•à‡§∂-‡§∏‡•Ä‡§≤‡•ç‡§° ‡§á‡§Ç‡§ú‡§® ‚Äî ‡§∞‡•Ä-‡§∏‡•Ä‡§≤ ‡§ï‡•á ‡§¨‡§ø‡§®‡§æ ‡§®‡§ø‡§Ø‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§¨‡§¶‡§≤‡§§‡•á',
    exTitle:'‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§Ü‡§ú‡§º‡§Æ‡§æ‡§è‡§Ç',exSub:'‡§Ø‡•á ‡§®‡§ï‡§≤‡•Ä ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§π‡•à‡§Ç ‚Äî ‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§ï‡•á ‡§≤‡§ø‡§è',
    ex1:'üö® ‡§∏‡•ç‡§ï‡•à‡§Æ ‡§â‡§¶‡§æ‡§π‡§∞‡§£',ex2:'üè¶ ‡§¨‡•à‡§Ç‡§ï SMS ‡§â‡§¶‡§æ‡§π‡§∞‡§£',ex3:'üèõ ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§≤‡§æ‡§π ‡§â‡§¶‡§æ‡§π‡§∞‡§£',
    limitTitle:'‡§¶‡•à‡§®‡§ø‡§ï ‡§∏‡•Ä‡§Æ‡§æ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§',limitText:'‡§Ü‡§™‡§®‡•á ‡§Ü‡§ú ‡§ï‡•Ä 10 ‡§ú‡§æ‡§Å‡§ö ‡§™‡•Ç‡§∞‡•Ä ‡§ï‡§∞ ‡§≤‡•Ä ‡§π‡•à‡§Ç‡•§<br>24 ‡§ò‡§Ç‡§ü‡•á ‡§¨‡§æ‡§¶ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§'
  }
};

let lang = localStorage.getItem('vg_lang') || 'en';
let lastResult = null;
let lastHash = '';
let engineVersion = '';
let engineVerified = false;

/* ‚ïê‚ïê HEALTH CHECK ‚ïê‚ïê */
async function checkHealth() {
  const pill = document.getElementById('engine-pill');
  const pillText = document.getElementById('engine-pill-text');
  const badge = document.getElementById('trust-badge');
  const badgeText = document.getElementById('trust-badge-text');
  const footerVer = document.getElementById('footer-ver');
  try {
    const r = await fetch(ENGINE_BASE + '/health', { signal: AbortSignal.timeout(5000) });
    if (!r.ok) throw new Error('not ok');
    const d = await r.json();
    engineVersion = d.version || 'unknown';
    const frozen = d.rules_frozen !== false;
    const hcOk   = d.hashchain_verified !== false;
    engineVerified = frozen && hcOk;
    pillText.textContent = 'ENGINE ' + engineVersion + ' ‚Äî ONLINE';
    pill.className = 'engine-pill online';
    footerVer.textContent = engineVersion;
    if (engineVerified) {
      badge.className = 'locked';
      badgeText.textContent = 'Rules Hard-Locked ¬∑ ' + engineVersion;
      document.getElementById('trust-badge').style.display = 'inline-flex';
    } else {
      badge.className = 'warn';
      badgeText.textContent = 'Engine Not Fully Verified';
      document.getElementById('trust-badge').style.display = 'inline-flex';
    }
    const infoText = document.getElementById('info-modal-text');
    if (infoText) infoText.innerHTML =
      'Engine: <strong>' + engineVersion + '</strong><br>' +
      'Rules frozen: ' + (frozen ? '‚úÖ Yes' : '‚ùå No') + '<br>' +
      'Hashchain: ' + (hcOk ? '‚úÖ Verified' : '‚ùå Not verified') + '<br><br>' +
      'This tool does NOT confirm fraud.<br>Low risk does NOT mean safe.';
  } catch(e) {
    pillText.textContent = 'ENGINE ‚Äî UNREACHABLE';
    pill.className = 'engine-pill offline';
    badge.className = 'warn';
    badgeText.textContent = '‚ö† Engine unreachable';
    document.getElementById('trust-badge').style.display = 'inline-flex';
    document.getElementById('analyze-btn').disabled = true;
  }
}

/* ‚ïê‚ïê RATE LIMIT ‚ïê‚ïê */
function getRD() {
  const t = new Date().toDateString();
  try { const d=JSON.parse(localStorage.getItem('vg_rate')||'{}'); return d.date===t?d:{date:t,used:0}; }
  catch(e){ return {date:new Date().toDateString(),used:0}; }
}
function saveRD(d){ localStorage.setItem('vg_rate',JSON.stringify(d)); }
function getRem(){ return Math.max(0, DAILY_LIMIT - getRD().used); }
function incUse(){ const d=getRD(); d.used++; saveRD(d); }

function renderRate() {
  const rem = getRem();
  const t = TXT[lang];
  document.getElementById('rate-label').innerHTML = t.rateText + ' <strong id="rate-num">' + rem + '</strong>/10';
  const el = document.getElementById('rate-dots');
  el.innerHTML = '';
  for (let i=0;i<DAILY_LIMIT;i++){
    const d=document.createElement('div');
    d.className='rdot'+(i>=rem?' used':'');
    el.appendChild(d);
  }
  const btn = document.getElementById('analyze-btn');
  const warn = document.getElementById('rate-warn');
  if (rem<=0) {
    btn.disabled=true;
    warn.textContent=t.rateWarn;
    warn.classList.add('show');
  } else {
    if(engineVerified||document.getElementById('engine-pill').classList.contains('online')) btn.disabled=false;
    warn.classList.remove('show');
  }
}

/* ‚ïê‚ïê STATS ‚ïê‚ïê */
async function loadStats() {
  try {
    const r = await fetch(ENGINE_BASE+'/stats',{signal:AbortSignal.timeout(4000)});
    if(!r.ok) return;
    const d = await r.json();
    if(d.total!==undefined) document.getElementById('stat-total').textContent=d.total;
    if(d.today!==undefined) document.getElementById('stat-today').textContent=d.today;
    if(d.flagged!==undefined) document.getElementById('stat-flagged').textContent=d.flagged;
  } catch(e){}
}

/* ‚ïê‚ïê ENGINE CALL ‚ïê‚ïê */
async function callEngine(text) {
  const r = await fetch(ENGINE_BASE+'/decide',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({input:text})
  });
  if(!r.ok) throw new Error('engine error');
  return r.json();
}

/* ‚ïê‚ïê ANALYZE ‚ïê‚ïê */
async function doAnalyze() {
  const text = document.getElementById('input-text').value.trim();
  if (!text) {
    const ta = document.getElementById('input-text');
    ta.style.borderColor='#9b2335';
    setTimeout(()=>ta.style.borderColor='',1000);
    return;
  }
  if (getRem()<=0) { openModal('limit-modal'); return; }
  const dm = DM[lang];
  const t  = TXT[lang];
  const btn = document.getElementById('analyze-btn');
  btn.disabled=true; btn.classList.add('loading');
  document.getElementById('btn-text').textContent=t.analyzing;
  try {
    const r = await callEngine(text);
    incUse(); renderRate(); loadStats();
    lastResult = r;
    lastHash = r.hash||'';
    renderResult(r, dm);
  } catch(e) {
    alert('‚ùå Engine not reachable ‚Äî check server');
  } finally {
    btn.classList.remove('loading');
    document.getElementById('btn-text').textContent=t.btnText;
    renderRate();
  }
}

/* ‚ïê‚ïê PARSE SIGNALS from fired_rules ‚ïê‚ïê */
function parseSignals(fired_rules) {
  const active = new Set();
  (fired_rules||[]).forEach(r => {
    if(/PHISH|KYC|IMPERSON|IDENTITY/i.test(r)) active.add('P');
    if(/MONEY|PAYMENT|TRANSFER|LOTTERY|FEE/i.test(r)) active.add('M');
    if(/AMOUNT|RUPEE|RS\.|‚Çπ|CASHBACK/i.test(r)) active.add('A');
    if(/LINK|URL|DOMAIN|HTTP|\.NET|\.XYZ|\.IN/i.test(r)) active.add('X');
    if(/URGENT|BLOCK|SUSPEND|VERIFY|OTP|CLICK|ACTION|CLAIM/i.test(r)) active.add('C');
    // Also check rule name prefixes
    if(r.startsWith('RULE_P')) active.add('P');
    if(r.startsWith('RULE_M')) active.add('M');
    if(r.startsWith('RULE_A')) active.add('A');
    if(r.startsWith('RULE_X')) active.add('X');
    if(r.startsWith('RULE_C')) active.add('C');
    // INTEGER_MATH_HIGH ‚Äî high risk multi-signal
    if(r==='RULE_INTEGER_MATH_HIGH') { active.add('A');active.add('C');active.add('X'); }
  });
  return active;
}

/* ‚ïê‚ïê GET CONF BAND ‚ïê‚ïê */
function getBand(conf, dm) {
  for(const b of dm.bands) if(conf<b.max) return b.label;
  return dm.bands[3].label;
}

/* ‚ïê‚ïê TRUNCATE HASH ‚ïê‚ïê */
function trunc(h){ return (!h||h.length<14)?h:h.slice(0,8)+'¬∑¬∑¬∑'+h.slice(-6); }

/* ‚ïê‚ïê RENDER RESULT ‚ïê‚ïê */
function renderResult(r, dm) {
  const v    = r.decision !== undefined ? r.decision : (r.verdict||0);
  const conf = (() => {
    if (typeof r.confidence === 'number') return r.confidence;
    if (typeof r.score === 'number') return r.score;
    if (r.confidence && typeof r.confidence.value === 'number') return r.confidence.value;
    // compute from trace if available
    if (r.trace && r.trace.length > 0) {
      const total = r.trace.reduce((s, t) => s + (t.score || t.weight || 0), 0);
      return Math.min(100, Math.round(total));
    }
    return 0;
  })();
  const rules = r.fired_rules || [];
  const trace = r.trace || [];
  const hash  = r.hash || 'pending';
  const signals = parseSignals(rules);
  const ver = engineVersion ? ' ¬∑ ' + engineVersion : '';
  const band = getBand(conf, dm);

  /* SIGNAL CHIPS HTML */
  const sigHTML = ['P','M','A','X','C'].map(s => {
    const active = signals.has(s);
    const meta = SIGNAL_META[s];
    const label = lang==='hi' ? s+' ‚Äî '+meta.hi : meta.label;
    return '<span class="signal-chip '+(active?'active-chip':'inactive-chip')+'" title="'+(lang==='hi'?meta.hi:meta.en)+'">'+(active?'‚óè':'‚óã')+' '+label+'</span>';
  }).join('');

  const sigDefHTML = signals.size>0
    ? '<div class="signal-def">'+
        [...signals].map(s=>lang==='hi'?SIGNAL_META[s].hi:SIGNAL_META[s].en).join(' ¬∑ ')
      +'</div>'
    : '';

  /* RULES HTML */
  const rulesHTML = rules.length>0
    ? rules.map(rule=>'<span class="rule-tag v'+v+'-tag">'+rule+'</span>').join('')
    : '<span class="rule-tag" style="background:var(--surface2);border-color:var(--border);color:var(--ink3)">'+dm.noRulesTag+'</span>';

  /* TRACE HTML */
  const traceHTML = trace.length>0
    ? trace.map(s=>'<div class="trace-row"><span>'+(s.step||'‚Äî')+'</span><span class="trace-val">'+(s.score!==undefined?s.score:s.weight!==undefined?'+'+s.weight:'‚Äî')+'</span></div>').join('')
    : '<div class="trace-row"><span>No trace data</span><span class="trace-val">‚Äî</span></div>';

  const el = document.getElementById('result-card');
  el.innerHTML =
    /* VERDICT HEADER */
    '<div class="verdict-header v'+v+'-header">' +
      '<div class="verdict-icon v'+v+'-icon">'+dm.emoji[v]+'</div>' +
      '<div class="verdict-main">' +
        '<div class="verdict-name v'+v+'-name">'+dm.label[v]+'</div>'+
        '<div class="verdict-sub">'+dm.sub[v]+'</div>'+
        '<div class="verdict-code">'+dm.code[v]+' ¬∑ '+dm.range[v]+'</div>'+
      '</div>'+
    '</div>'+
    /* HASHCHAIN ‚Äî ALWAYS VISIBLE ‚úÖ */
    '<div class="hash-strip">'+
      '<div class="hash-verified-badge">'+
        '<span class="hash-check">‚úÖ</span>'+
        '<div class="hash-texts">'+
          '<div class="hash-title">'+dm.hashTitle+ver+'</div>'+
          '<div class="hash-val">'+trunc(hash)+'</div>'+
        '</div>'+
      '</div>'+
      '<div class="hash-actions">'+
        '<button class="hash-btn" onclick="copyHash()">'+dm.hashCopy+'</button>'+
        '<button class="hash-btn" onclick="openModal(\'hash-modal\')">'+dm.hashLearn+'</button>'+
      '</div>'+
    '</div>'+
    /* RESULT DISCLAIMER */
    '<div class="result-disc v'+v+'-disc">‚ö† '+dm.disc[v]+'</div>'+
    /* SUMMARY */
    '<div class="summary">'+dm.summary[v]+'</div>'+
    /* SIGNAL BREAKDOWN ‚Äî P/M/A/X/C */
    '<div class="signals-wrap">'+
      '<div class="signals-title">SIGNAL BREAKDOWN</div>'+
      '<div class="signals-grid">'+sigHTML+'</div>'+
      sigDefHTML+
    '</div>'+
    /* CONFIDENCE */
    '<div class="conf-wrap">'+
      '<div class="conf-top"><span>CONFIDENCE</span><span class="conf-pct v'+v+'-name">'+conf+'%</span></div>'+
      '<div class="conf-track"><div class="conf-fill v'+v+'-fill" id="conf-fill"></div></div>'+
      '<div class="conf-band v'+v+'-band">'+band+'</div>'+
      '<div class="conf-note">'+dm.confNote+'</div>'+
    '</div>'+
    /* TRIGGERED RULES */
    '<div class="rules-wrap">'+
      '<div class="section-hdr" onclick="toggleSec(\'ra\',\'rb\')"><span class="caret" id="ra">‚ñ∂</span> '+dm.ruleHdr+'</div>'+
      '<div class="rules-body" id="rb">'+rulesHTML+'</div>'+
    '</div>'+
    /* TRACE */
    '<div class="trace-wrap">'+
      '<div class="section-hdr" onclick="toggleSec(\'ta\',\'tb\')"><span class="caret" id="ta">‚ñ∂</span> üîí '+dm.traceHdr+'</div>'+
      '<div class="trace-note">'+dm.traceNote+'</div>'+
      '<div class="trace-body" id="tb">'+traceHTML+'</div>'+
    '</div>'+
    /* ACTIONS */
    '<div class="actions-wrap">'+
      '<div class="action-btns">'+
        '<button class="act-btn btn-share" onclick="shareResult()">'+dm.share+'</button>'+
        '<button class="act-btn btn-copy" onclick="copyProof()">'+dm.copy+'</button>'+
      '</div>'+
      '<div class="action-note">'+dm.actNote+'</div>'+
    '</div>'+
    /* SAFE NOTICE */
    '<div class="safe-notice">'+dm.safeNotice+'</div>'+
    /* FEEDBACK */
    '<div class="fb-wrap">'+
      '<span class="fb-lbl">'+dm.fbLbl+'</span>'+
      '<button class="fb-btn" id="fb-yes" onclick="giveFb(\'yes\')">'+dm.fbYes+'</button>'+
      '<button class="fb-btn" id="fb-no" onclick="giveFb(\'no\')">'+dm.fbNo+'</button>'+
      '<span class="fb-thanks" id="fb-thanks">'+dm.fbThanks+'</span>'+
      '<span class="fb-once">'+dm.fbOnce+'</span>'+
    '</div>';

  el.style.display='block';
  setTimeout(()=>{ const f=document.getElementById('conf-fill'); if(f) f.style.width=conf+'%'; },100);
  el.scrollIntoView({behavior:'smooth',block:'nearest'});
}

/* ‚ïê‚ïê HELPERS ‚ïê‚ïê */
function toggleSec(caretId, bodyId) {
  const c=document.getElementById(caretId);
  const b=document.getElementById(bodyId);
  if(c) c.classList.toggle('open');
  if(b) b.classList.toggle('open');
}

function copyHash() {
  if(!lastHash) return;
  navigator.clipboard.writeText(lastHash).then(()=>showToast(DM[lang].hashCopied));
}

function buildProof() {
  if(!lastResult) return '';
  const r=lastResult; const dm=DM[lang];
  const v=r.decision!==undefined?r.decision:(r.verdict||0);
  return 'VERITAS GUARD ‚Äî RISK ANALYSIS\n'+
    '================================\n'+
    'Verdict    : '+dm.label[v]+'\n'+
    'Decision   : '+dm.code[v]+'\n'+
    'Confidence : '+(r.confidence||0)+'%\n'+
    'Signals    : '+(r.fired_rules||[]).join(', ')||'None'+'\n'+
    'Hash       : '+(r.hash||'pending')+'\n'+
    'Engine     : '+(engineVersion||'unknown')+' ¬∑ RULES FROZEN\n'+
    'Time       : '+new Date().toLocaleString()+'\n'+
    '================================\n'+
    'NOTE: Low risk does NOT mean safe.\n'+
    'veritasengine.in';
}

function copyProof() {
  const t=buildProof(); if(!t) return;
  navigator.clipboard.writeText(t).then(()=>showToast(DM[lang].toastCopy));
}

function shareResult() {
  const t=buildProof(); if(!t) return;
  if(navigator.share) navigator.share({title:'Veritas Guard ‚Äî Risk Analysis',text:t});
  else navigator.clipboard.writeText(t).then(()=>showToast(DM[lang].toastCopy));
}

function giveFb(type) {
  const y=document.getElementById('fb-yes');
  const n=document.getElementById('fb-no');
  const thanks=document.getElementById('fb-thanks');
  if(!y||!n) return;
  y.disabled=true; n.disabled=true;
  y.classList.toggle('sel',type==='yes');
  n.classList.toggle('sel',type==='no');
  if(thanks) thanks.classList.add('show');
}

function showToast(msg) {
  const el=document.getElementById('toast');
  el.textContent=msg; el.classList.add('show');
  setTimeout(()=>el.classList.remove('show'),2500);
}

function openModal(id){ document.getElementById(id).classList.add('show'); }
function closeModal(id){ document.getElementById(id).classList.remove('show'); }
function showInfoModal(){ openModal('info-modal'); }

function loadEx(i) {
  const inp=document.getElementById('input-text');
  inp.value=EXAMPLES[i];
  document.getElementById('char-val').textContent=EXAMPLES[i].length;
  inp.focus();
}

/* ‚ïê‚ïê LANG ‚ïê‚ïê */
function setLang(l) { lang=l; localStorage.setItem('vg_lang',l); applyLang(); }

function applyLang() {
  const t=TXT[lang]; const dm=DM[lang];
  const map={
    'tagline-text':t.tagline,'lbl-usecase':t.lblUsecase,'lbl-input':t.lblInput,
    'btn-text':t.btnText,'nd1':t.nd1,'nd2':t.nd2,'nd3':t.nd3,
    'lbl-total':t.lblTotal,'lbl-today':t.lblToday,
    'disc-title':t.discTitle,'disc-body':t.discBody,
    'how-title':t.howTitle,'how1':t.how1,'how2':t.how2,'how3':t.how3,'how4':t.how4,
    'ex-title':t.exTitle,'ex-sub':t.exSub,'ex1':t.ex1,'ex2':t.ex2,'ex3':t.ex3,
    'limit-title':t.limitTitle
  };
  for(const [id,val] of Object.entries(map)){ const el=document.getElementById(id); if(el) el.textContent=val; }
  const lt=document.getElementById('limit-text'); if(lt) lt.innerHTML=t.limitText;
  document.getElementById('input-text').placeholder=t.placeholder;
  document.querySelectorAll('#usecase option').forEach(o=>{
    o.textContent=lang==='hi'?o.dataset.hi:o.dataset.en;
  });
  document.getElementById('btn-en').classList.toggle('active',lang==='en');
  // Image button text
  const imgBtn = document.getElementById('img-btn-text');
  if (imgBtn && !document.getElementById('img-preview-wrap').classList.contains('show')) {
    imgBtn.textContent = lang === 'hi' ? '‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§Ö‡§™‡§≤‡•ã‡§°' : 'Upload Screenshot';
  }
  document.getElementById('btn-hi').classList.toggle('active',lang==='hi');
  renderRate();
}

/* ‚ïê‚ïê DEV BYPASS ‚ïê‚ïê */
document.addEventListener('input', e=>{
  if(e.target.id==='input-text' && e.target.value.trim()===DEV_CODE){
    const d=getRD(); d.used=0; saveRD(d);
    e.target.value=''; document.getElementById('char-val').textContent='0';
    renderRate(); showToast('‚úÖ Dev: Limit reset!');
  }
});


/* ‚ïê‚ïê IMAGE UPLOAD + OCR ‚Äî Tesseract.js ‚ïê‚ïê */
function setStatus(msg, type) {
  const el = document.getElementById('img-status');
  el.textContent = msg;
  el.className = 'img-status ' + (type||'');
}

function setProgress(pct) {
  const bar = document.getElementById('prog-bar');
  if (bar) bar.style.width = pct + '%';
}

async function handleImage(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = async (e) => {
    const imgSrc = e.target.result;

    // Compact preview ‚Äî just thumbnail + filename
    document.getElementById('img-preview').src = imgSrc;
    document.getElementById('img-filename').textContent = file.name.length > 20 ? file.name.slice(0,18)+'...' : file.name;
    document.getElementById('img-preview-wrap').classList.add('show');
    document.getElementById('img-btn-text').textContent = lang === 'hi' ? '‡§¨‡§¶‡§≤‡•á‡§Ç' : 'Change';
    setProgress(0);

    // Step 1
    setStatus(lang === 'hi' ? 'üì§ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...' : 'üì§ Uploading...', '');
    await new Promise(r => setTimeout(r, 300));

    // Step 2
    setStatus(lang === 'hi' ? 'üîç ‡§™‡§¢‡§º‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...' : 'üîç Reading...', '');
    setProgress(20);

    try {
      const { data: { text } } = await Tesseract.recognize(
        imgSrc,
        'eng+hin',
        {
          logger: m => {
            if (m.status === 'recognizing text') {
              const pct = 20 + Math.round((m.progress||0) * 70);
              setProgress(pct);
            }
          }
        }
      );

      setProgress(90);

      // Step 3 ‚Äî clean text
      const cleaned = text.replace(/[ \t]+/g, ' ').trim();
      setProgress(100);

      if (cleaned && cleaned.length > 3) {
        document.getElementById('input-text').value = cleaned;
        document.getElementById('char-val').textContent = cleaned.length;
        // Step 4 ‚Äî copied to box
        setStatus(lang === 'hi' ? '‚úÖ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ' : '‚úÖ Text copied to box', 'ok');
      } else {
        setStatus(lang === 'hi' ? '‚ö† ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ' : '‚ö† No text found', 'warn');
      }
    } catch(err) {
      setStatus(lang === 'hi' ? '‚ö† ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‚Äî ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç' : '‚ö† Error ‚Äî type manually', 'warn');
    }
  };
  reader.readAsDataURL(file);
}

function clearImage() {
  document.getElementById('img-preview-wrap').classList.remove('show');
  document.getElementById('img-preview').src = '';
  document.getElementById('img-input').value = '';
  document.getElementById('img-filename').textContent = '';
  setStatus('', '');
  setProgress(0);
  document.getElementById('img-btn-text').textContent = lang === 'hi' ? '‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§Ö‡§™‡§≤‡•ã‡§°' : 'Upload Screenshot';
}

/* ‚ïê‚ïê INIT ‚ïê‚ïê */
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('input-text').addEventListener('input',function(){
    document.getElementById('char-val').textContent=this.value.length;
  });
  document.getElementById('clear-btn').addEventListener('click',()=>{
    document.getElementById('input-text').value='';
    document.getElementById('char-val').textContent='0';
    document.getElementById('result-card').style.display='none';
    lastResult=null; lastHash='';
  });
  applyLang();
  checkHealth();
  loadStats();
});
</script>
</body>
</html>
