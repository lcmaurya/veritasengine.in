<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Veritas Guard ‚Äî Risk Awareness Tool</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/5.0.4/tesseract.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   VERITAS GUARD v1.5 ‚Äî DAYLIGHT READABLE
   Explainer + Integrity tool ¬∑ Not enforcement
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
:root{
  --bg:#f0ede8; --bg2:#e8e4de;
  --surface:#fff; --surface2:#f7f5f2;
  --border:#d4cfc8; --border-strong:#b8b2aa;
  --ink:#1a1714; --ink2:#3d3830; --ink3:#6b6560;
  --brand:#1d4ed8; --brand2:#1e40af; --brand-light:#eff6ff;
  --v0:#4a5568; --v0bg:#edf2f7; --v0bd:#cbd5e0;
  --v1:#276749; --v1bg:#f0fff4; --v1bd:#9ae6b4;
  --v2:#c05621; --v2bg:#fffaf0; --v2bd:#fbd38d;
  --v3:#9b2335; --v3bg:#fff5f5; --v3bd:#feb2b2;
  --mono:'Space Mono',monospace;
  --sans:'DM Sans',sans-serif;
  --r:10px;
  --sh:0 1px 3px rgba(0,0,0,.08),0 4px 12px rgba(0,0,0,.06);
  --sh-lg:0 4px 16px rgba(0,0,0,.12),0 12px 32px rgba(0,0,0,.08);
}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--ink);font-family:var(--sans);min-height:100vh;-webkit-font-smoothing:antialiased}

/* MARQUEE */
#warn-bar{position:fixed;top:0;left:0;right:0;z-index:200;background:var(--ink);padding:6px 0;overflow:hidden}
#warn-text{display:inline-block;white-space:nowrap;font-family:var(--mono);font-size:10px;color:#a8a29e;animation:marquee 32s linear infinite;padding-left:100%}
@keyframes marquee{from{transform:translateX(0)}to{transform:translateX(-200%)}}

#app{max-width:480px;margin:0 auto;padding:52px 14px 60px}

/* HEADER */
.header{text-align:center;padding:24px 0 18px;border-bottom:1px solid var(--border);margin-bottom:14px}
.logo-row{display:inline-flex;align-items:center;gap:9px;margin-bottom:5px}
.logo-icon{width:34px;height:34px;background:var(--brand);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:17px}
.logo-name{font-family:var(--mono);font-size:21px;font-weight:700;color:var(--ink);letter-spacing:-1px}
.tagline{font-family:var(--mono);font-size:9px;color:var(--ink3);letter-spacing:2px;text-transform:uppercase;margin-bottom:8px}
.no-ai-pill{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;background:var(--surface2);border:1px solid var(--border);border-radius:20px;font-family:var(--mono);font-size:9px;color:var(--ink3);margin-bottom:8px}

/* ENGINE PILL */
.engine-pill{display:inline-flex;align-items:center;gap:6px;padding:4px 13px;border-radius:20px;font-family:var(--mono);font-size:10px;border:1.5px solid;cursor:pointer;transition:all .2s;margin-bottom:3px}
.engine-pill.online{background:#f0fff4;border-color:#9ae6b4;color:#276749}
.engine-pill.offline{background:#fff5f5;border-color:#feb2b2;color:#9b2335}
.engine-pill.checking{background:var(--surface2);border-color:var(--border);color:var(--ink3)}
.dot{width:6px;height:6px;border-radius:50%;animation:blink 2s infinite;flex-shrink:0}
.engine-pill.online .dot{background:#276749}
.engine-pill.offline .dot{background:#9b2335}
.engine-pill.checking .dot{background:var(--ink3)}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
#trust-badge{display:none;align-items:center;gap:5px;padding:3px 11px;border-radius:20px;font-family:var(--mono);font-size:9px;border:1.5px solid;margin-top:3px}
#trust-badge.locked{display:inline-flex;background:#f0fff4;border-color:#9ae6b4;color:#276749}
#trust-badge.warn{display:inline-flex;background:#fffaf0;border-color:#fbd38d;color:#c05621}

/* STATS */
.stats-row{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:12px}
.stat-card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--r);padding:10px 6px;text-align:center;box-shadow:var(--sh)}
.stat-num{font-family:var(--mono);font-size:22px;font-weight:700;color:var(--brand);line-height:1}
.stat-lbl{font-size:9px;color:var(--ink3);text-transform:uppercase;letter-spacing:1px;margin-top:3px;font-weight:600}
.stat-sub{font-family:var(--mono);font-size:8px;color:var(--border-strong);margin-top:1px}

/* RATE */
.rate-wrap{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--r);padding:9px 14px;margin-bottom:8px;display:flex;align-items:center;justify-content:space-between;box-shadow:var(--sh)}
.rate-label{font-family:var(--mono);font-size:11px;color:var(--ink2)}
.rate-label strong{color:var(--brand)}
.rate-dots{display:flex;gap:3px}
.rdot{width:7px;height:7px;border-radius:50%;background:var(--brand)}
.rdot.used{background:var(--border)}
.rate-warn{background:#fff5f5;border:1.5px solid #feb2b2;border-radius:var(--r);padding:8px 14px;font-family:var(--mono);font-size:11px;color:#9b2335;text-align:center;margin-bottom:8px;display:none}
.rate-warn.show{display:block}

/* INPUT CARD */
.card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--r);padding:15px;margin-bottom:10px;box-shadow:var(--sh)}
.lang-row{display:flex;gap:6px;margin-bottom:13px}
.lang-btn{flex:1;padding:7px;background:transparent;border:1.5px solid var(--border);border-radius:6px;color:var(--ink3);font-family:var(--mono);font-size:11px;cursor:pointer;transition:all .2s;font-weight:700}
.lang-btn.active{background:var(--ink);border-color:var(--ink);color:#fff}
.field-lbl{font-family:var(--mono);font-size:9px;color:var(--ink3);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:5px;font-weight:700}
select{width:100%;padding:9px 12px;background:var(--surface2);border:1.5px solid var(--border);border-radius:6px;color:var(--ink);font-family:var(--sans);font-size:13px;margin-bottom:12px;outline:none;appearance:none;cursor:pointer;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath fill='%231a1714' d='M5 6L0 0h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;font-weight:500}
select:focus{border-color:var(--ink)}
select option{background:#fff;color:var(--ink)}
textarea{width:100%;height:108px;padding:11px;background:var(--surface2);border:1.5px solid var(--border);border-radius:6px;color:var(--ink);font-family:var(--mono);font-size:12px;resize:none;outline:none;line-height:1.65;transition:border-color .2s}
textarea:focus{border-color:var(--ink);background:#fff}
textarea::placeholder{color:var(--border-strong)}
.char-row{display:flex;justify-content:space-between;align-items:center;margin-top:5px;margin-bottom:12px}
.clear-btn{background:#eff6ff;border:1.5px solid var(--brand);color:var(--brand);padding:4px 10px;border-radius:5px;font-size:10px;font-family:var(--mono);cursor:pointer;font-weight:700}
.char-count{font-family:var(--mono);font-size:10px;color:var(--ink3)}

/* IMAGE UPLOAD */
.img-upload-row{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap}
.img-upload-btn{display:inline-flex;align-items:center;gap:6px;padding:6px 13px;background:#eff6ff;border:1.5px dashed var(--brand);border-radius:6px;color:var(--brand);font-family:var(--mono);font-size:11px;cursor:pointer;transition:all .2s;font-weight:700}
.img-upload-btn:hover{background:#dbeafe;border-style:solid}
.img-upload-btn input{display:none}
.img-preview-wrap{display:none;margin-bottom:8px;border-radius:6px;border:1.5px solid var(--brand)}
.img-preview-wrap.show{display:flex;align-items:center;gap:8px;padding:6px 10px;background:#eff6ff;flex-wrap:wrap}
.img-thumb{width:50px;height:50px;object-fit:cover;border-radius:4px;border:1px solid var(--brand);flex-shrink:0}
.img-info{flex:1;min-width:0}
.img-filename{font-family:var(--mono);font-size:10px;color:var(--brand);font-weight:700;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.img-clear-btn{background:transparent;border:1.5px solid var(--brand);color:var(--brand);border-radius:4px;padding:3px 8px;font-family:var(--mono);font-size:10px;cursor:pointer;font-weight:700;flex-shrink:0}
.img-status{font-family:var(--mono);font-size:10px;font-weight:700}
.img-status.ok{color:#276749} .img-status.warn{color:#c05621}
.img-processing{display:none;font-family:var(--mono);font-size:10px;color:var(--ink3);align-items:center;gap:5px}
.img-processing.show{display:flex}
.prog-wrap{width:100%;height:4px;background:var(--border);border-radius:2px;margin-top:4px;overflow:hidden}
.prog-fill{height:100%;background:var(--brand);border-radius:2px;width:0%;transition:width .3s}

/* ANALYZE BTN */
#analyze-btn{width:100%;padding:14px;background:var(--brand);border:2px solid var(--brand2);border-radius:8px;color:#fff;font-family:var(--mono);font-weight:700;font-size:14px;letter-spacing:.5px;cursor:pointer;transition:all .2s;box-shadow:0 3px 10px rgba(29,78,216,.35);position:relative;overflow:hidden}
#analyze-btn:hover:not(:disabled){background:var(--brand2);transform:translateY(-1px);box-shadow:0 5px 18px rgba(29,78,216,.4)}
#analyze-btn:disabled{opacity:.45;cursor:not-allowed;transform:none}
#analyze-btn.loading::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);animation:shimmer 1s infinite}
@keyframes shimmer{to{left:100%}}
.trust-pills{display:flex;justify-content:center;gap:10px;margin-top:7px;flex-wrap:wrap}
.tpill{font-family:var(--mono);font-size:9px;color:var(--ink3);display:flex;align-items:center;gap:3px}
.tpill::before{content:'‚úì';color:var(--brand);font-weight:700}

/* RESULT CARD */
#result-card{display:none;border-radius:var(--r);overflow:hidden;margin-bottom:10px;border:1.5px solid var(--border);box-shadow:var(--sh-lg);animation:slideIn .25s ease}
@keyframes slideIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}

/* VERDICT HEADER */
.verdict-header{padding:15px;display:flex;align-items:flex-start;gap:12px}
.verdict-icon{width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:19px;flex-shrink:0;border:2px solid;font-family:var(--mono);font-weight:700}
.verdict-main{flex:1;min-width:0}
.verdict-name{font-family:var(--mono);font-size:17px;font-weight:700;line-height:1.1}
.verdict-sub{font-size:12px;margin-top:3px;font-weight:500;line-height:1.4}
.verdict-code{font-family:var(--mono);font-size:9px;margin-top:4px;opacity:.55}
.checked-time{padding:5px 15px;font-family:var(--mono);font-size:9px;color:var(--ink3);background:var(--surface2);border-bottom:1px solid var(--border)}

/* HASHCHAIN STRIP ‚Äî always visible */
.hash-strip{padding:11px 15px;background:#f0fff4;border-top:2px solid #9ae6b4;border-bottom:2px solid #9ae6b4}
.hash-strip-top{display:flex;align-items:center;gap:7px;flex-wrap:wrap;margin-bottom:5px}
.hash-lock{font-size:14px}
.hash-title{font-family:var(--mono);font-size:11px;font-weight:700;color:#276749}
.hash-what{font-family:var(--mono);font-size:9px;color:var(--brand);cursor:pointer;text-decoration:underline;margin-left:auto}
.hash-mono-row{display:flex;align-items:center;gap:6px;background:#fff;border:1px solid #9ae6b4;border-radius:5px;padding:5px 8px}
.hash-mono-val{font-family:var(--mono);font-size:9px;color:var(--ink2);overflow-x:auto;white-space:nowrap;flex:1;scrollbar-width:thin}
.hash-copy-btn{background:transparent;border:none;cursor:pointer;font-size:13px;flex-shrink:0;padding:0 2px;opacity:.7;transition:opacity .2s}
.hash-copy-btn:hover{opacity:1}
.hash-verify-btn{display:inline-flex;align-items:center;gap:4px;margin-top:6px;padding:4px 11px;background:transparent;border:1.5px solid #276749;border-radius:5px;font-family:var(--mono);font-size:10px;color:#276749;cursor:pointer;font-weight:700;transition:all .2s}
.hash-verify-btn:hover{background:#276749;color:#fff}
.inline-verify-result{display:none;margin-top:6px;padding:7px 10px;border-radius:6px;font-family:var(--mono);font-size:10px;border:1.5px solid;line-height:1.6}
.inline-verify-result.valid{background:#f0fff4;border-color:#9ae6b4;color:#276749}
.inline-verify-result.invalid{background:#fff5f5;border-color:#feb2b2;color:#9b2335}
.inline-verify-result.warn{background:#fffaf0;border-color:#fbd38d;color:#c05621}
.inline-verify-result.show{display:block}

/* RESULT DISCLAIMER */
.result-disc{padding:8px 15px;font-family:var(--mono);font-size:10px;border-bottom:1px solid var(--border);line-height:1.5}
/* SUMMARY */
.summary{padding:12px 15px;font-size:13px;line-height:1.65;font-weight:500;border-bottom:1px solid var(--border);color:var(--ink2)}

/* SIGNAL BREAKDOWN */
.signals-wrap{padding:11px 15px;border-bottom:1px solid var(--border);background:var(--surface)}
.section-title{font-family:var(--mono);font-size:9px;text-transform:uppercase;letter-spacing:1.5px;color:var(--ink3);margin-bottom:7px;font-weight:700}
.signals-grid{display:flex;gap:5px;flex-wrap:wrap}
.signal-chip{display:inline-flex;align-items:center;gap:4px;padding:5px 9px;border-radius:6px;font-family:var(--mono);font-size:10px;border:1.5px solid;font-weight:700}
.signal-chip.on{background:var(--v3bg);border-color:var(--v3bd);color:var(--v3)}
.signal-chip.off{background:var(--surface2);border-color:var(--border);color:var(--ink3)}
.signal-def{font-size:10px;color:var(--ink2);margin-top:6px;line-height:1.5;padding:7px 10px;background:var(--surface2);border-radius:5px;border-left:3px solid var(--brand)}

/* SIGNAL STRENGTH */
.conf-wrap{padding:11px 15px;border-bottom:1px solid var(--border)}
.conf-top{display:flex;justify-content:space-between;align-items:center;font-family:var(--mono);font-size:10px;color:var(--ink2);margin-bottom:5px;font-weight:700}
.conf-pct{font-size:15px;font-weight:700}
.conf-track{height:8px;background:var(--bg2);border-radius:4px;overflow:hidden;border:1px solid var(--border)}
.conf-fill{height:100%;border-radius:4px;width:0%;transition:width .8s cubic-bezier(.4,0,.2,1)}
.conf-band{font-family:var(--mono);font-size:9px;margin-top:4px;font-weight:700}
.conf-note{font-size:10px;color:var(--ink3);margin-top:3px;line-height:1.5;font-style:italic}

/* RULES */
.rules-wrap{padding:11px 15px;border-bottom:1px solid var(--border)}
.collapsible-hdr{font-family:var(--mono);font-size:9px;text-transform:uppercase;letter-spacing:1.5px;color:var(--ink3);margin-bottom:0;font-weight:700;display:flex;align-items:center;gap:6px;cursor:pointer;user-select:none}
.caret{font-size:8px;transition:transform .2s;display:inline-block}
.caret.open{transform:rotate(90deg)}
.collapsible-body{display:none;flex-wrap:wrap;gap:5px;margin-top:7px}
.collapsible-body.open{display:flex}
.rule-tag{padding:4px 10px;border-radius:5px;font-family:var(--mono);font-size:10px;border:1.5px solid;font-weight:700}

/* ACTIONS */
.actions-wrap{padding:12px 15px;border-bottom:1px solid var(--border)}
.action-btns{display:flex;gap:8px}
.act-btn{flex:1;padding:10px;border-radius:7px;font-family:var(--mono);font-size:11px;cursor:pointer;transition:all .2s;font-weight:700;letter-spacing:.3px}
.btn-share{background:var(--brand);border:none;color:#fff}
.btn-share:hover{background:var(--brand2)}
.btn-copy{background:transparent;border:1.5px solid var(--border-strong);color:var(--ink2)}
.btn-copy:hover{border-color:var(--ink);color:var(--ink);background:var(--surface2)}
.btn-verify-proof{background:transparent;border:1.5px solid #276749;color:#276749;padding:7px 12px;border-radius:7px;font-family:var(--mono);font-size:11px;cursor:pointer;font-weight:700;transition:all .2s;margin-top:7px;width:100%}
.btn-verify-proof:hover{background:#276749;color:#fff}
.action-note{font-family:var(--mono);font-size:9px;color:var(--ink3);text-align:center;margin-top:5px}

/* SAFE NOTICE */
.safe-notice{padding:9px 15px;background:var(--surface2);font-size:11px;color:var(--ink3);line-height:1.6;border-bottom:1px solid var(--border);border-left:3px solid var(--brand)}

/* FEEDBACK */
.fb-wrap{padding:10px 15px;display:flex;align-items:center;gap:9px;flex-wrap:wrap;background:var(--surface)}
.fb-lbl{font-family:var(--mono);font-size:10px;color:var(--ink3);font-weight:700}
.fb-btn{padding:4px 12px;background:transparent;border:1.5px solid var(--border);border-radius:20px;font-size:11px;color:var(--ink3);cursor:pointer;font-family:var(--mono);transition:all .2s;font-weight:700}
.fb-btn.sel{background:var(--ink);border-color:var(--ink);color:#fff}
.fb-btn:disabled{opacity:.5;cursor:not-allowed}
.fb-thanks{font-family:var(--mono);font-size:10px;color:#276749;display:none;font-weight:700}
.fb-thanks.show{display:inline}

/* EXAMPLES */
.examples-card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--r);padding:13px;margin-bottom:10px;box-shadow:var(--sh)}
.ex-btns{display:flex;flex-direction:column;gap:6px;margin-top:8px}
.ex-btn{width:100%;padding:9px 12px;background:var(--surface2);border:1.5px solid var(--border);border-radius:7px;color:var(--ink2);font-family:var(--mono);font-size:11px;cursor:pointer;text-align:left;transition:all .2s;font-weight:700}
.ex-btn:hover{border-color:var(--ink);color:var(--ink);background:#fff}

/* INFO CARDS */
.info-card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--r);padding:13px 15px;margin-bottom:10px;box-shadow:var(--sh)}
.info-title{font-family:var(--mono);font-size:9px;color:var(--brand);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:6px;font-weight:700}
.info-body{font-size:12px;color:var(--ink2);line-height:1.7}
.how-list{margin-top:8px;display:flex;flex-direction:column;gap:6px}
.how-item{display:flex;align-items:flex-start;gap:8px;font-size:12px;color:var(--ink2);line-height:1.5}
.how-item::before{content:'‚óÜ';color:var(--brand);font-size:8px;flex-shrink:0;margin-top:3px}

/* TRUST FOOTER */
.trust-footer{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--r);padding:12px 15px;margin-bottom:10px;text-align:center;box-shadow:var(--sh)}
.tf1{font-family:var(--mono);font-size:11px;color:var(--ink);font-weight:700;margin-bottom:3px}
.tf1 span{color:var(--brand)}
.tf2{font-size:11px;color:var(--ink3)}

footer{text-align:center;font-family:var(--mono);font-size:9px;color:var(--border-strong);padding:10px 0 8px;line-height:2}

/* VERDICT COLORS */
.v0-h{background:var(--v0bg);border-bottom:1px solid var(--v0bd)} .v0-icon{border-color:var(--v0bd);color:var(--v0);background:var(--v0bg)} .v0-name{color:var(--v0)} .v0-disc{background:#edf2f7;border-color:var(--v0bd);color:var(--v0)} .v0-fill{background:var(--v0)} .v0-band{color:var(--v0)} .v0-tag{background:var(--v0bg);border-color:var(--v0bd);color:var(--v0)}
.v1-h{background:var(--v1bg);border-bottom:1px solid var(--v1bd)} .v1-icon{border-color:var(--v1bd);color:var(--v1);background:var(--v1bg)} .v1-name{color:var(--v1)} .v1-disc{background:#f0fff4;border-color:var(--v1bd);color:var(--v1)} .v1-fill{background:var(--v1)} .v1-band{color:var(--v1)} .v1-tag{background:var(--v1bg);border-color:var(--v1bd);color:var(--v1)}
.v2-h{background:var(--v2bg);border-bottom:1px solid var(--v2bd)} .v2-icon{border-color:var(--v2bd);color:var(--v2);background:var(--v2bg)} .v2-name{color:var(--v2)} .v2-disc{background:#fffaf0;border-color:var(--v2bd);color:var(--v2)} .v2-fill{background:var(--v2)} .v2-band{color:var(--v2)} .v2-tag{background:var(--v2bg);border-color:var(--v2bd);color:var(--v2)}
.v3-h{background:var(--v3bg);border-bottom:1px solid var(--v3bd)} .v3-icon{border-color:var(--v3bd);color:var(--v3);background:var(--v3bg)} .v3-name{color:var(--v3)} .v3-disc{background:#fff5f5;border-color:var(--v3bd);color:var(--v3)} .v3-fill{background:var(--v3)} .v3-band{color:var(--v3)} .v3-tag{background:var(--v3bg);border-color:var(--v3bd);color:var(--v3)}

/* MODALS */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(26,23,20,.65);z-index:300;align-items:flex-end;justify-content:center;padding:0}
.modal-overlay.show{display:flex}
@media(min-width:480px){.modal-overlay{align-items:center;padding:20px}}
.modal-box{background:#fff;border-radius:14px 14px 0 0;padding:24px 20px;width:100%;max-width:480px;box-shadow:var(--sh-lg);max-height:90vh;overflow-y:auto}
@media(min-width:480px){.modal-box{border-radius:14px;max-height:80vh}}
.modal-icon{font-size:30px;margin-bottom:8px;text-align:center}
.modal-title{font-family:var(--mono);font-size:15px;font-weight:700;color:var(--ink);margin-bottom:8px;text-align:center}
.modal-text{font-family:var(--mono);font-size:11px;color:var(--ink3);line-height:1.9;margin-bottom:14px;text-align:center}
.modal-close{width:100%;padding:11px;background:var(--brand);border:none;border-radius:8px;color:#fff;font-family:var(--mono);font-weight:700;font-size:12px;cursor:pointer;transition:background .2s}
.modal-close:hover{background:var(--brand2)}

/* VERIFY MODAL */
.verify-modal-text{font-family:var(--mono);font-size:10px;color:var(--ink3);line-height:1.8;margin-bottom:10px;padding:8px 10px;background:var(--surface2);border-radius:6px;border-left:3px solid var(--brand)}
.verify-ta{width:100%;height:100px;padding:10px;background:var(--surface2);border:1.5px solid var(--border);border-radius:6px;color:var(--ink);font-family:var(--mono);font-size:10px;resize:none;outline:none;line-height:1.6;margin-bottom:8px}
.verify-ta:focus{border-color:var(--brand)}
.verify-btn-modal{width:100%;padding:11px;background:var(--brand);border:none;border-radius:8px;color:#fff;font-family:var(--mono);font-weight:700;font-size:12px;cursor:pointer;margin-bottom:8px;transition:background .2s}
.verify-btn-modal:hover{background:var(--brand2)}
.verify-btn-modal:disabled{opacity:.4;cursor:not-allowed}
.verify-res{display:none;padding:10px 12px;border-radius:7px;font-family:var(--mono);font-size:11px;border:1.5px solid;line-height:1.7;margin-bottom:8px}
.verify-res.valid{background:#f0fff4;border-color:#9ae6b4;color:#276749}
.verify-res.invalid{background:#fff5f5;border-color:#feb2b2;color:#9b2335}
.verify-res.warn{background:#fffaf0;border-color:#fbd38d;color:#c05621}
.verify-res.show{display:block}
.verify-adv{font-family:var(--mono);font-size:9px;color:var(--brand);cursor:pointer;text-decoration:underline;display:none}
.verify-adv.show{display:inline}
.verify-raw{display:none;margin-top:5px;font-family:var(--mono);font-size:9px;color:var(--ink3);word-break:break-all;line-height:1.6;padding:6px;background:var(--surface2);border-radius:4px}
.verify-raw.show{display:block}
.modal-cancel{width:100%;padding:9px;background:transparent;border:1.5px solid var(--border);border-radius:8px;color:var(--ink3);font-family:var(--mono);font-weight:700;font-size:12px;cursor:pointer;margin-top:4px}

/* TOAST */
#toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--ink);border-radius:7px;padding:8px 18px;font-family:var(--mono);font-size:11px;color:#fff;z-index:400;opacity:0;transition:opacity .3s;pointer-events:none;white-space:nowrap;font-weight:700;box-shadow:var(--sh-lg)}
#toast.show{opacity:1}
</style>
</head>
<body>

<!-- MARQUEE -->
<div id="warn-bar">
  <span id="warn-text">‚ö† This tool shows risk patterns only. It does NOT confirm fraud, block messages, or guarantee safety. Final decision is always yours. ¬∑ ‡§Ø‡§π ‡§ü‡•Ç‡§≤ ‡§ï‡•á‡§µ‡§≤ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§¶‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§</span>
</div>

<div id="app">

  <!-- HEADER -->
  <div class="header">
    <div class="logo-row">
      <div class="logo-icon">üõ°</div>
      <div class="logo-name">Veritas Guard</div>
    </div>
    <div class="tagline" id="tagline-text">Risk Pattern Explainer ¬∑ Not an enforcement tool</div>
    <div class="no-ai-pill">No AI ¬∑ No Prediction ¬∑ Deterministic Rules Only</div>
    <br>
    <div class="engine-pill checking" id="engine-pill" onclick="showInfoModal()">
      <div class="dot"></div>
      <span id="engine-pill-text">ENGINE ‚Äî CHECKING...</span>
    </div>
    <br>
    <div id="trust-badge"><span>üîí</span> <span id="trust-badge-text">Rules Hard-Locked</span></div>
  </div>

  <!-- STATS -->
  <div class="stats-row">
    <div class="stat-card">
      <div class="stat-num" id="stat-total">0</div>
      <div class="stat-lbl" id="lbl-total">Total</div>
      <div class="stat-sub">Session</div>
    </div>
    <div class="stat-card">
      <div class="stat-num" id="stat-today">0</div>
      <div class="stat-lbl" id="lbl-today">Today</div>
      <div class="stat-sub">Daily reset</div>
    </div>
    <div class="stat-card">
      <div class="stat-num" id="stat-flagged">0</div>
      <div class="stat-lbl">Flagged</div>
      <div class="stat-sub">Risk found</div>
    </div>
  </div>

  <!-- RATE -->
  <div class="rate-wrap">
    <div class="rate-label" id="rate-label">Remaining: <strong>10</strong>/10</div>
    <div class="rate-dots" id="rate-dots"></div>
  </div>
  <div class="rate-warn" id="rate-warn">Daily limit reached. Try again later.</div>

  <!-- INPUT CARD -->
  <div class="card">
    <div class="lang-row">
      <button class="lang-btn active" id="btn-en" onclick="setLang('en')">EN</button>
      <button class="lang-btn" id="btn-hi" onclick="setLang('hi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
    </div>
    <div class="field-lbl" id="lbl-usecase">USE CASE</div>
    <select id="usecase">
      <option value="cyber"      data-en="Cyber / Fraud"       data-hi="‡§∏‡§æ‡§á‡§¨‡§∞ / ‡§´‡•ç‡§∞‡•â‡§°">Cyber / Fraud</option>
      <option value="banking"    data-en="Banking / Fintech"    data-hi="‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó / ‡§´‡§ø‡§®‡§ü‡•á‡§ï">Banking / Fintech</option>
      <option value="legal"      data-en="Legal / Compliance"   data-hi="‡§ï‡§æ‡§®‡•Ç‡§®‡•Ä / ‡§Ö‡§®‡•Å‡§™‡§æ‡§≤‡§®">Legal / Compliance</option>
      <option value="health"     data-en="Healthcare"           data-hi="‡§π‡•á‡§≤‡•ç‡§•‡§ï‡•á‡§Ø‡§∞">Healthcare</option>
      <option value="insurance"  data-en="Insurance"            data-hi="‡§¨‡•Ä‡§Æ‡§æ">Insurance</option>
      <option value="govt"       data-en="Government / Public"  data-hi="‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä / ‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï">Government / Public</option>
      <option value="ecom"       data-en="E-commerce"           data-hi="‡§à-‡§ï‡•â‡§Æ‡§∞‡•ç‡§∏">E-commerce</option>
      <option value="edu"        data-en="Education / Research" data-hi="‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ / ‡§Ö‡§®‡•Å‡§∏‡§Ç‡§ß‡§æ‡§®">Education / Research</option>
      <option value="enterprise" data-en="Enterprise Security"  data-hi="‡§è‡§Ç‡§ü‡§∞‡§™‡•ç‡§∞‡§æ‡§á‡§ú ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ">Enterprise Security</option>
    </select>
    <div class="field-lbl" id="lbl-input">MESSAGE / SMS / LINK</div>
    <div class="img-upload-row">
      <label class="img-upload-btn">
        üì∑ <span id="img-btn-text">Upload Screenshot</span>
        <input type="file" id="img-input" accept="image/*" onchange="handleImage(event)">
      </label>
      <span class="img-status" id="img-status"></span>
      <span class="img-processing" id="img-processing"><span id="img-proc-text">‚ü≥ Reading...</span></span>
    </div>
    <div class="img-preview-wrap" id="img-preview-wrap">
      <img class="img-thumb" id="img-preview" src="" alt="">
      <div class="img-info">
        <div class="img-filename" id="img-filename">screenshot.jpg</div>
        <div class="prog-wrap"><div class="prog-fill" id="prog-bar"></div></div>
      </div>
      <button class="img-clear-btn" onclick="clearImage()">‚úï</button>
    </div>
    <textarea id="input-text" maxlength="1000" placeholder="Paste SMS, WhatsApp message, or link here..."></textarea>
    <div class="char-row">
      <button class="clear-btn" id="clear-btn">‚úï CLEAR</button>
      <span class="char-count"><span id="char-val">0</span>/1000</span>
    </div>
    <button id="analyze-btn" onclick="doAnalyze()">
      <span id="btn-text">‚ö° ANALYZE RISK SIGNALS</span>
    </button>
    <div class="trust-pills">
      <span class="tpill" id="nd1">No Login</span>
      <span class="tpill" id="nd2">No Storage</span>
      <span class="tpill" id="nd3">Deterministic Rules</span>
    </div>
  </div>

  <!-- RESULT CARD -->
  <div id="result-card"></div>

  <!-- EXAMPLES -->
  <div class="examples-card">
    <div class="section-title" id="ex-title">TRY AN EXAMPLE</div>
    <div class="info-body" id="ex-sub" style="font-size:10px;color:var(--ink3)">Simulated messages for testing only</div>
    <div class="ex-btns">
      <button class="ex-btn" id="ex1" onclick="loadEx(0)">üö® Try scam-pattern example</button>
      <button class="ex-btn" id="ex2" onclick="loadEx(1)">üè¶ Try bank SMS example</button>
      <button class="ex-btn" id="ex3" onclick="loadEx(2)">üèõ Try government advisory example</button>
    </div>
  </div>

  <!-- DISCLAIMER -->
  <div class="info-card">
    <div class="info-title" id="disc-title">‚ö† DISCLAIMER</div>
    <p class="info-body" id="disc-body">This tool shows risk patterns based on known signals only. It does not confirm fraud. Low risk does not mean safe. The final decision is always yours.</p>
  </div>

  <!-- HOW IT WORKS -->
  <div class="info-card">
    <div class="info-title" id="how-title">HOW THIS WORKS</div>
    <div class="how-list">
      <div class="how-item" id="how1">No login required ‚Äî works instantly</div>
      <div class="how-item" id="how2">Message content is never stored</div>
      <div class="how-item" id="how3">Rules are fixed ‚Äî no prediction or guessing</div>
      <div class="how-item" id="how4">Each result is sealed ‚Äî can be verified later</div>
    </div>
  </div>

  <!-- TRUST FOOTER -->
  <div class="trust-footer">
    <div class="tf1">ENGINE <span id="footer-ver">v1.5</span> ¬∑ RULES FROZEN</div>
    <div class="tf2">Deterministic ¬∑ No AI ¬∑ No message storage</div>
  </div>

  <footer id="footer-copy">¬© Veritas Engine ‚Äî Open Risk Awareness Tool</footer>
</div>

<!-- TOAST -->
<div id="toast"></div>

<!-- INFO MODAL -->
<div class="modal-overlay" id="info-modal">
  <div class="modal-box">
    <div class="modal-icon">üõ°</div>
    <div class="modal-title">About Veritas Guard</div>
    <div class="modal-text" id="info-modal-text">
      This tool detects risk patterns in messages.<br><br>
      It does NOT confirm fraud, block anything, or make decisions for you.<br><br>
      Results are based on known risk signals ‚Äî not AI or prediction.
    </div>
    <button class="modal-close" onclick="closeModal('info-modal')">Understood</button>
  </div>
</div>

<!-- HASHCHAIN EXPLAINER MODAL -->
<div class="modal-overlay" id="hash-modal">
  <div class="modal-box">
    <div class="modal-icon">üîí</div>
    <div class="modal-title">Result Integrity</div>
    <div class="modal-text">
      This result is sealed at the moment it was generated.<br><br>
      The rules used for this analysis cannot be changed later.<br><br>
      This proves the analysis was not modified after generation.<br><br>
      <span style="font-size:10px;opacity:.7">You can verify any copied proof using the Verify Proof button.</span>
    </div>
    <button class="modal-close" onclick="closeModal('hash-modal')">Understood</button>
  </div>
</div>

<!-- VERIFY PROOF MODAL -->
<div class="modal-overlay" id="verify-modal">
  <div class="modal-box">
    <div class="modal-icon">üîç</div>
    <div class="modal-title">Verify Proof</div>
    <div class="verify-modal-text">
      This checks whether the copied proof matches the engine output.<br>
      It does NOT determine fraud or safety.
    </div>
    <textarea class="verify-ta" id="verify-ta" placeholder="Paste proof text here...&#10;(from COPY PROOF button)"></textarea>
    <button class="verify-btn-modal" id="verify-btn-modal" onclick="doVerify()">‚ö° VERIFY</button>
    <div class="verify-res" id="verify-res"></div>
    <span class="verify-adv" id="verify-adv" onclick="toggleVerifyRaw()">Show proof details</span>
    <div class="verify-raw" id="verify-raw"></div>
    <button class="modal-cancel" onclick="closeModal('verify-modal')">Close</button>
  </div>
</div>

<!-- LIMIT MODAL -->
<div class="modal-overlay" id="limit-modal">
  <div class="modal-box">
    <div class="modal-icon">‚è≥</div>
    <div class="modal-title" id="limit-title">Daily Limit Reached</div>
    <div class="modal-text" id="limit-text">You have used all 10 analyses for today.<br>Please try again after 24 hours.</div>
    <button class="modal-close" onclick="closeModal('limit-modal')">OK</button>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CONFIG
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const ENGINE_BASE = 'https://api.veritasengine.in';
const DAILY_LIMIT = 10;
const DEV_CODE    = 'VERITAS-DEV-2026';

const EXAMPLES = [
  'Congratulations! You won Rs.5,00,000 lottery. Pay Rs.2,500 processing fee to claim. Visit: bit.ly/claim-now',
  'Sent Rs.1,250 from HDFC Bank A/c XX1234 to Amazon Pay. UPI Ref 9837264512. Not you? Call 1800-XXX-XXXX',
  'Important advisory from Ministry of Finance: Be aware of fake calls posing as income tax officials. Visit incometax.gov.in only.'
];

/* ‚ïê‚ïê SIGNAL METADATA ‚ïê‚ïê */
const SIG = {
  P:{ label:'P ‚Äî Phishing',    en:'Impersonation or identity fraud signal', hi:'‡§™‡§π‡§ö‡§æ‡§® ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§∏‡§Ç‡§ï‡•á‡§§' },
  M:{ label:'M ‚Äî Money',       en:'Monetary request or reward signal',       hi:'‡§™‡•à‡§∏‡•á ‡§ï‡•Ä ‡§Æ‡§æ‡§Ç‡§ó ‡§Ø‡§æ ‡§á‡§®‡§æ‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§' },
  A:{ label:'A ‚Äî Amount',      en:'Specific amount pattern detected',        hi:'‡§∞‡§æ‡§∂‡§ø ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡§æ' },
  X:{ label:'X ‚Äî External',    en:'Suspicious external link detected',       hi:'‡§∏‡§Ç‡§¶‡§ø‡§ó‡•ç‡§ß ‡§¨‡§æ‡§π‡§∞‡•Ä ‡§≤‡§ø‡§Ç‡§ï' },
  C:{ label:'C ‚Äî Urgency',     en:'Urgency or pressure signal detected',     hi:'‡§§‡§§‡•ç‡§ï‡§æ‡§≤‡§§‡§æ ‡§ï‡•Ä ‡§Æ‡§æ‡§Ç‡§ó' }
};

/* ‚ïê‚ïê DECISION MAP ‚ïê‚ïê */
const DM = {
  en:{
    label:  ['No Pattern Detected','Attention Required','Risk Patterns Detected','Multiple Risk Patterns Detected'],
    sub:    [
      'No known risk signals found in this message.',
      'Weak or partial risk signals detected. Verify before acting.',
      'Multiple risk patterns detected. Signals commonly seen in scams.',
      'Strong risk signals detected. Avoid action until verified independently.'
    ],
    code:   ['DECISION 0','DECISION 1','DECISION 2','DECISION 3'],
    range:  ['Signal 0‚Äì20%','Signal 20‚Äì45%','Signal 45‚Äì75%','Signal 75‚Äì100%'],
    emoji:  ['‚Äî','!','‚ö†','‚úñ'],
    disc:   [
      'No patterns found. This does not mean the message is safe.',
      'Weak signals detected. Verify the sender before any action.',
      'Multiple risk patterns found. Extra caution advised.',
      'Strong risk signals. Avoid action until verified independently.'
    ],
    summary:[
      'No known risk patterns were found. This does not guarantee the message is safe. Final decision is always yours.',
      'Weak risk signals detected. Verify the sender independently before taking any action.',
      'Multiple risk patterns detected. These are signals commonly seen in scams. Extra caution is advised.',
      'Strong risk signals detected. Avoid sharing details, clicking links, or making payments until you have independently verified the source.'
    ],
    bands:[
      {max:20, label:'Very low signal ‚Äî no strong patterns matched'},
      {max:45, label:'Weak signal ‚Äî partial patterns matched'},
      {max:75, label:'Moderate signal ‚Äî multiple patterns matched'},
      {max:101,label:'Strong signal ‚Äî high-risk patterns matched'}
    ],
    confNote:'Signal strength shows how many known risk patterns matched ‚Äî not a fraud verdict.',
    noRulesTag:'No patterns triggered',
    ruleHdr:'MATCHED PATTERNS',
    hashTitle:'‚úÖ Result Integrity Sealed',
    hashCopy:'Copy Hash',
    hashLearn:'What is this?',
    hashVerify:'Verify Integrity',
    hashCopied:'Hash copied ‚úì',
    safeNotice:'Risk patterns are based on known signals only. Extra caution is advised ‚Äî this is not a final verdict. Final decision is always yours.',
    disc2:'This tool detects risk patterns. It does NOT say fraud, block anything, or decide for you.',
    fbLbl:'Was this result clear?',fbYes:'Yes',fbNo:'Unclear',
    fbThanks:'Thanks. Feedback noted (anonymous).',
    share:'SHARE',copy:'COPY PROOF',verifyProof:'VERIFY PROOF',
    actNote:'Includes: decision ¬∑ intent ¬∑ fired_rules ¬∑ score ¬∑ hash',
    toastCopy:'Proof copied ‚Äî verify anytime using Verify Proof',
    toastHash:'Hash copied ‚úì'
  },
  hi:{
    label:  ['‡§ï‡•ã‡§à ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç','‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç','‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á','‡§ï‡§à ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á'],
    sub:    [
      '‡§á‡§∏ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Æ‡•á‡§Ç ‡§ï‡•ã‡§à ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á‡•§',
      '‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç‡•§',
      '‡§ï‡§à ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§∏‡•ç‡§ï‡•à‡§Æ ‡§Æ‡•á‡§Ç ‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§ê‡§∏‡•á ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§π‡•ã‡§§‡•á ‡§π‡•à‡§Ç‡•§',
      '‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§‡•§ ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§∞‡•Ç‡§™ ‡§∏‡•á ‡§ú‡§æ‡§Å‡§ö‡•á ‡§¨‡§ø‡§®‡§æ ‡§ï‡•ã‡§à ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§'
    ],
    code:   ['‡§®‡§ø‡§∞‡•ç‡§£‡§Ø 0','‡§®‡§ø‡§∞‡•ç‡§£‡§Ø 1','‡§®‡§ø‡§∞‡•ç‡§£‡§Ø 2','‡§®‡§ø‡§∞‡•ç‡§£‡§Ø 3'],
    range:  ['‡§∏‡§Ç‡§ï‡•á‡§§ 0‚Äì20%','‡§∏‡§Ç‡§ï‡•á‡§§ 20‚Äì45%','‡§∏‡§Ç‡§ï‡•á‡§§ 45‚Äì75%','‡§∏‡§Ç‡§ï‡•á‡§§ 75‚Äì100%'],
    emoji:  ['‚Äî','!','‚ö†','‚úñ'],
    disc:   [
      '‡§ï‡•ã‡§à ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç‡•§ ‡§Ø‡§π ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§π‡•ã‡§®‡•á ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§',
      '‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§∏‡§Ç‡§ï‡•á‡§§‡•§ ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç‡•§',
      '‡§ï‡§à ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∏‡§æ‡§µ‡§ß‡§æ‡§®‡•Ä ‡§¨‡§∞‡§§‡•á‡§Ç‡•§',
      '‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§∏‡§Ç‡§ï‡•á‡§§‡•§ ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§ú‡§æ‡§Å‡§ö ‡§ï‡•á ‡§¨‡§ø‡§®‡§æ ‡§ï‡•ã‡§à ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§'
    ],
    summary:[
      '‡§ï‡•ã‡§à ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ‡•§ ‡§Ø‡§π ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§‡§§‡§æ ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§',
      '‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§ï‡§æ‡§∞‡•ç‡§∞‡§µ‡§æ‡§à ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§∏‡•ç‡§∞‡•ã‡§§ ‡§ï‡•Ä ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§∞‡•á‡§Ç‡•§',
      '‡§ï‡§à ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§Ø‡•á ‡§∏‡•ç‡§ï‡•à‡§Æ ‡§Æ‡•á‡§Ç ‡§Ü‡§Æ‡§§‡•å‡§∞ ‡§™‡§∞ ‡§¶‡•á‡§ñ‡•á ‡§ú‡§æ‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§π‡•à‡§Ç‡•§ ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∏‡§æ‡§µ‡§ß‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§∏‡§≤‡§æ‡§π ‡§¶‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§',
      '‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§Æ‡§ø‡§≤‡•á‡•§ ‡§∏‡•ç‡§∞‡•ã‡§§ ‡§ï‡•Ä ‡§∏‡•ç‡§µ‡§§‡§Ç‡§§‡•ç‡§∞ ‡§ú‡§æ‡§Å‡§ö ‡§ï‡§ø‡§è ‡§¨‡§ø‡§®‡§æ ‡§ï‡•ã‡§à ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§∏‡§æ‡§ù‡§æ ‡§® ‡§ï‡§∞‡•á‡§Ç, ‡§≤‡§ø‡§Ç‡§ï ‡§® ‡§ñ‡•ã‡§≤‡•á‡§Ç, ‡§Ø‡§æ ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§'
    ],
    bands:[
      {max:20, label:'‡§¨‡§π‡•Å‡§§ ‡§ï‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‚Äî ‡§ï‡•ã‡§à ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç'},
      {max:45, label:'‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§∏‡§Ç‡§ï‡•á‡§§ ‚Äî ‡§Ü‡§Ç‡§∂‡§ø‡§ï ‡§™‡•à‡§ü‡§∞‡•ç‡§®'},
      {max:75, label:'‡§Æ‡§ß‡•ç‡§Ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‚Äî ‡§ï‡§à ‡§™‡•à‡§ü‡§∞‡•ç‡§®'},
      {max:101,label:'‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§∏‡§Ç‡§ï‡•á‡§§ ‚Äî ‡§â‡§ö‡•ç‡§ö ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§®'}
    ],
    confNote:'‡§∏‡§Ç‡§ï‡•á‡§§ ‡§∂‡§ï‡•ç‡§§‡§ø ‡§¶‡§ø‡§ñ‡§æ‡§§‡•Ä ‡§π‡•à ‡§ï‡§ø ‡§ï‡§ø‡§§‡§®‡•á ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§Æ‡§ø‡§≤‡•á ‚Äî ‡§Ø‡§π ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§',
    noRulesTag:'‡§ï‡•ã‡§à ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ',
    ruleHdr:'‡§Æ‡§ø‡§≤‡•á ‡§™‡•à‡§ü‡§∞‡•ç‡§®',
    hashTitle:'‚úÖ ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§Ö‡§ñ‡§Ç‡§°‡§§‡§æ ‡§∏‡•Ä‡§≤',
    hashCopy:'‡§π‡•à‡§∂ ‡§ï‡•â‡§™‡•Ä',
    hashLearn:'‡§Ø‡§π ‡§ï‡•ç‡§Ø‡§æ ‡§π‡•à?',
    hashVerify:'‡§Ö‡§ñ‡§Ç‡§°‡§§‡§æ ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç',
    hashCopied:'‡§π‡•à‡§∂ ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ ‚úì',
    safeNotice:'‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§ï‡•á‡§µ‡§≤ ‡§ú‡•ç‡§û‡§æ‡§§ ‡§∏‡§Ç‡§ï‡•á‡§§‡•ã‡§Ç ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§π‡•à‡§Ç‡•§ ‡§Ö‡§§‡§ø‡§∞‡§ø‡§ï‡•ç‡§§ ‡§∏‡§æ‡§µ‡§ß‡§æ‡§®‡•Ä ‡§ï‡•Ä ‡§∏‡§≤‡§æ‡§π ‚Äî ‡§Ø‡§π ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡•§',
    disc2:'‡§Ø‡§π ‡§ü‡•Ç‡§≤ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§¶‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§π‡§§‡§æ, ‡§ï‡•Å‡§õ ‡§¨‡•ç‡§≤‡•â‡§ï ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§',
    fbLbl:'‡§ï‡•ç‡§Ø‡§æ ‡§Ø‡§π ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§•‡§æ?',fbYes:'‡§π‡§æ‡§Å',fbNo:'‡§Ö‡§∏‡•ç‡§™‡§∑‡•ç‡§ü',
    fbThanks:'‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶‡•§ ‡§´‡•Ä‡§°‡§¨‡•à‡§ï ‡§¶‡§∞‡•ç‡§ú‡•§',
    share:'‡§∂‡•á‡§Ø‡§∞',copy:'‡§™‡•ç‡§∞‡•Ç‡§´ ‡§ï‡•â‡§™‡•Ä',verifyProof:'‡§™‡•ç‡§∞‡•Ç‡§´ ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç',
    actNote:'‡§∂‡§æ‡§Æ‡§ø‡§≤: decision ¬∑ intent ¬∑ fired_rules ¬∑ score ¬∑ hash',
    toastCopy:'‡§™‡•ç‡§∞‡•Ç‡§´ ‡§ï‡•â‡§™‡•Ä ‚Äî Verify Proof ‡§∏‡•á ‡§ú‡§æ‡§Å‡§ö‡•á‡§Ç',
    toastHash:'‡§π‡•à‡§∂ ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ ‚úì'
  }
};

/* UI TEXT */
const TXT={
  en:{tagline:'Risk Pattern Explainer ¬∑ Not an enforcement tool',lblUsecase:'USE CASE',lblInput:'MESSAGE / SMS / LINK',btnText:'‚ö° ANALYZE RISK SIGNALS',analyzing:'ANALYZING...',nd1:'No Login',nd2:'No Storage',nd3:'Deterministic Rules',lbl_total:'Total',lbl_today:'Today',rateText:'Remaining:',rateWarn:'Daily limit reached. Try again later.',discTitle:'‚ö† DISCLAIMER',discBody:'This tool shows risk patterns based on known signals only. It does not confirm fraud. Low risk does not mean safe. Final decision is always yours.',howTitle:'HOW THIS WORKS',how1:'No login required ‚Äî works instantly',how2:'Message content is never stored',how3:'Rules are fixed ‚Äî no prediction or guessing',how4:'Each result is sealed ‚Äî can be verified later',exTitle:'TRY AN EXAMPLE',exSub:'Simulated messages for testing only',ex1:'üö® Try scam-pattern example',ex2:'üè¶ Try bank SMS example',ex3:'üèõ Try government advisory example',limitTitle:'Daily Limit Reached',limitText:'You have used all 10 analyses for today.<br>Please try again after 24 hours.'},
  hi:{tagline:'‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§µ‡•ç‡§Ø‡§æ‡§ñ‡•ç‡§Ø‡§æ‡§ï‡§æ‡§∞ ¬∑ ‡§™‡•ç‡§∞‡§µ‡§∞‡•ç‡§§‡§® ‡§â‡§™‡§ï‡§∞‡§£ ‡§®‡§π‡•Ä‡§Ç',lblUsecase:'‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞',lblInput:'‡§∏‡§Ç‡§¶‡•á‡§∂ / SMS / ‡§≤‡§ø‡§Ç‡§ï',btnText:'‚ö° ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç',analyzing:'‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...',nd1:'‡§ï‡•ã‡§à ‡§≤‡•â‡§ó‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç',nd2:'‡§ï‡•ã‡§à ‡§∏‡•ç‡§ü‡•ã‡§∞‡•á‡§ú ‡§®‡§π‡•Ä‡§Ç',nd3:'‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§®‡§ø‡§Ø‡§Æ',lbl_total:'‡§ï‡•Å‡§≤',lbl_today:'‡§Ü‡§ú',rateText:'‡§∂‡•á‡§∑:',rateWarn:'‡§¶‡•à‡§®‡§ø‡§ï ‡§∏‡•Ä‡§Æ‡§æ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§‡•§',discTitle:'‚ö† ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§∞‡§£',discBody:'‡§Ø‡§π ‡§ü‡•Ç‡§≤ ‡§ï‡•á‡§µ‡§≤ ‡§ú‡•ç‡§û‡§æ‡§§ ‡§∏‡§Ç‡§ï‡•á‡§§‡•ã‡§Ç ‡§™‡§∞ ‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§¶‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§',howTitle:'‡§Ø‡§π ‡§ï‡•à‡§∏‡•á ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à',how1:'‡§ï‡•ã‡§à ‡§≤‡•â‡§ó‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç',how2:'‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∏‡§æ‡§Æ‡§ó‡•ç‡§∞‡•Ä ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡•Ä‡§§ ‡§®‡§π‡•Ä‡§Ç',how3:'‡§®‡§ø‡§Ø‡§Æ ‡§®‡§ø‡§∂‡•ç‡§ö‡§ø‡§§ ‡§π‡•à‡§Ç ‚Äî ‡§ï‡•ã‡§à ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§® ‡§®‡§π‡•Ä‡§Ç',how4:'‡§™‡•ç‡§∞‡§§‡•ç‡§Ø‡•á‡§ï ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§∏‡•Ä‡§≤ ‚Äî ‡§¨‡§æ‡§¶ ‡§Æ‡•á‡§Ç ‡§ú‡§æ‡§Å‡§ö ‡§Ø‡•ã‡§ó‡•ç‡§Ø',exTitle:'‡§â‡§¶‡§æ‡§π‡§∞‡§£ ‡§Ü‡§ú‡§º‡§Æ‡§æ‡§è‡§Ç',exSub:'‡§Ø‡•á ‡§®‡§ï‡§≤‡•Ä ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§π‡•à‡§Ç',ex1:'üö® ‡§∏‡•ç‡§ï‡•à‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§â‡§¶‡§æ‡§π‡§∞‡§£',ex2:'üè¶ ‡§¨‡•à‡§Ç‡§ï SMS ‡§â‡§¶‡§æ‡§π‡§∞‡§£',ex3:'üèõ ‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä ‡§∏‡§≤‡§æ‡§π ‡§â‡§¶‡§æ‡§π‡§∞‡§£',limitTitle:'‡§¶‡•à‡§®‡§ø‡§ï ‡§∏‡•Ä‡§Æ‡§æ ‡§∏‡§Æ‡§æ‡§™‡•ç‡§§',limitText:'‡§Ü‡§™‡§®‡•á ‡§Ü‡§ú ‡§ï‡•Ä 10 ‡§ú‡§æ‡§Å‡§ö ‡§™‡•Ç‡§∞‡•Ä ‡§ï‡§∞ ‡§≤‡•Ä ‡§π‡•à‡§Ç‡•§<br>24 ‡§ò‡§Ç‡§ü‡•á ‡§¨‡§æ‡§¶ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§'}
};

let lang = localStorage.getItem('vg_lang')||'en';
let lastResult = null;
let lastHash   = '';
let engineVersion = '';
let sessionScans = 0;

/* ‚ïê‚ïê HEALTH ‚ïê‚ïê */
async function checkHealth(){
  const pill=document.getElementById('engine-pill');
  const pillTxt=document.getElementById('engine-pill-text');
  const badge=document.getElementById('trust-badge');
  const badgeTxt=document.getElementById('trust-badge-text');
  try{
    const r=await fetch(ENGINE_BASE+'/health',{signal:AbortSignal.timeout(5000)});
    if(!r.ok) throw new Error();
    const d=await r.json();
    engineVersion=d.version||'v1.5';
    document.getElementById('footer-ver').textContent=engineVersion;
    pillTxt.textContent='ENGINE '+engineVersion+' ‚Äî ONLINE';
    pill.className='engine-pill online';
    const ok=d.rules_frozen!==false && d.hashchain_verified!==false;
    badge.className=ok?'locked':'warn';
    badgeTxt.textContent=ok?'Rules Hard-Locked ¬∑ '+engineVersion:'Engine Not Fully Verified';
    document.getElementById('analyze-btn').disabled=false;
  }catch(e){
    pillTxt.textContent='ENGINE ‚Äî UNREACHABLE';
    pill.className='engine-pill offline';
    badge.className='warn';
    badgeTxt.textContent='‚ö† Engine unreachable';
    document.getElementById('analyze-btn').disabled=true;
  }
}

/* ‚ïê‚ïê STATS ‚Äî session + localStorage ‚ïê‚ïê */
function getStats(){
  const today=new Date().toDateString();
  try{const s=JSON.parse(localStorage.getItem('vg_stats')||'{}');return s.date===today?s:{date:today,today:0,flagged:0};}
  catch(e){return{date:new Date().toDateString(),today:0,flagged:0};}
}
function saveStats(s){try{localStorage.setItem('vg_stats',JSON.stringify(s));}catch(e){}}
function updateStats(decision){
  sessionScans++;
  const s=getStats();
  s.today=(s.today||0)+1;
  if(decision>=2) s.flagged=(s.flagged||0)+1;
  saveStats(s);
  renderStats();
}
function renderStats(){
  const s=getStats();
  document.getElementById('stat-total').textContent=sessionScans;
  document.getElementById('stat-today').textContent=s.today||0;
  document.getElementById('stat-flagged').textContent=s.flagged||0;
}

/* ‚ïê‚ïê RATE LIMIT ‚ïê‚ïê */
function getRD(){const t=new Date().toDateString();try{const d=JSON.parse(localStorage.getItem('vg_rate')||'{}');return d.date===t?d:{date:t,used:0};}catch(e){return{date:new Date().toDateString(),used:0};}}
function saveRD(d){localStorage.setItem('vg_rate',JSON.stringify(d));}
function getRem(){return Math.max(0,DAILY_LIMIT-getRD().used);}
function incUse(){const d=getRD();d.used++;saveRD(d);}
function renderRate(){
  const rem=getRem();const t=TXT[lang];
  document.getElementById('rate-label').innerHTML=t.rateText+' <strong>'+rem+'</strong>/10';
  const el=document.getElementById('rate-dots');el.innerHTML='';
  for(let i=0;i<DAILY_LIMIT;i++){const d=document.createElement('div');d.className='rdot'+(i>=rem?' used':'');el.appendChild(d);}
  const btn=document.getElementById('analyze-btn');
  const warn=document.getElementById('rate-warn');
  if(rem<=0){btn.disabled=true;warn.textContent=t.rateWarn;warn.classList.add('show');}
  else{if(document.getElementById('engine-pill').classList.contains('online'))btn.disabled=false;warn.classList.remove('show');}
}

/* ‚ïê‚ïê ENGINE CALL ‚ïê‚ïê */
async function callEngine(text){
  const r=await fetch(ENGINE_BASE+'/decide',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({input:text})});
  if(!r.ok) throw new Error('engine error');
  return r.json();
}

/* ‚ïê‚ïê ANALYZE ‚ïê‚ïê */
async function doAnalyze(){
  const text=document.getElementById('input-text').value.trim();
  if(!text){const ta=document.getElementById('input-text');ta.style.borderColor='#9b2335';setTimeout(()=>ta.style.borderColor='',1000);return;}
  if(getRem()<=0){openModal('limit-modal');return;}
  const dm=DM[lang];const t=TXT[lang];
  const btn=document.getElementById('analyze-btn');
  btn.disabled=true;btn.classList.add('loading');
  document.getElementById('btn-text').textContent=t.analyzing;
  try{
    const r=await callEngine(text);
    incUse();updateStats(r.decision);renderRate();
    lastResult=r;lastHash=r.hash||'';
    renderResult(r,dm);
  }catch(e){showToast('‚ùå Engine not reachable');}
  finally{btn.classList.remove('loading');document.getElementById('btn-text').textContent=t.btnText;renderRate();}
}

/* ‚ïê‚ïê PARSE SIGNALS ‚ïê‚ïê */
function parseSignals(fired){
  const a=new Set();
  (fired||[]).forEach(r=>{
    if(/PHISH|KYC|IMPERSON|IDENTITY/i.test(r))a.add('P');
    if(/MONEY|PAYMENT|TRANSFER|LOTTERY|FEE/i.test(r))a.add('M');
    if(/AMOUNT|RUPEE|RS\b|CASHBACK/i.test(r))a.add('A');
    if(/LINK|URL|DOMAIN|HTTP|\.NET|\.XYZ/i.test(r))a.add('X');
    if(/URGENT|BLOCK|SUSPEND|VERIFY|OTP|CLAIM/i.test(r))a.add('C');
    if(r.startsWith('RULE_P'))a.add('P');if(r.startsWith('RULE_M'))a.add('M');
    if(r.startsWith('RULE_A'))a.add('A');if(r.startsWith('RULE_X'))a.add('X');
    if(r.startsWith('RULE_C'))a.add('C');
    if(r==='RULE_INTEGER_MATH_HIGH'){a.add('A');a.add('C');a.add('X');}
  });
  return a;
}

/* ‚ïê‚ïê BAND ‚ïê‚ïê */
function getBand(sc,dm){for(const b of dm.bands)if(sc<b.max)return b.label;return dm.bands[3].label;}

/* ‚ïê‚ïê FORMAT TIME ‚Äî UI only, NOT in verify payload ‚ïê‚ïê */
function formatTime(){
  const n=new Date();const h=n.getHours();const m=n.getMinutes();
  const ap=h>=12?'PM':'AM';const hh=h%12||12;const mm=String(m).padStart(2,'0');
  return 'Checked '+hh+':'+mm+' '+ap;
}

/* ‚ïê‚ïê RENDER RESULT ‚ïê‚ïê */
function renderResult(r,dm){
  const v=r.decision!==undefined?r.decision:0;
  const score=r.score||0;
  const rules=r.fired_rules||[];
  const hash=r.hash||'pending';
  const signals=parseSignals(rules);
  const ver=engineVersion?' ¬∑ '+engineVersion:'';
  const band=getBand(score,dm);

  const sigHTML=['P','M','A','X','C'].map(s=>{
    const on=signals.has(s);const meta=SIG[s];
    const lbl=lang==='hi'?s+' ‚Äî '+meta.hi:meta.label;
    return '<span class="signal-chip '+(on?'on':'off')+'" title="'+(lang==='hi'?meta.hi:meta.en)+'">'+(on?'‚óè':'‚óã')+' '+lbl+'</span>';
  }).join('');

  const sigDef=signals.size>0?'<div class="signal-def">'+[...signals].map(s=>lang==='hi'?SIG[s].hi:SIG[s].en).join('<br>')+'</div>':'';

  const rulesHTML=rules.length>0
    ?rules.map(rule=>'<span class="rule-tag v'+v+'-tag">'+rule+'</span>').join('')
    :'<span class="rule-tag" style="background:var(--surface2);border-color:var(--border);color:var(--ink3)">'+dm.noRulesTag+'</span>';

  document.getElementById('result-card').innerHTML=
    /* 1. VERDICT */
    '<div class="verdict-header v'+v+'-h">'+
      '<div class="verdict-icon v'+v+'-icon">'+dm.emoji[v]+'</div>'+
      '<div class="verdict-main">'+
        '<div class="verdict-name v'+v+'-name">'+dm.label[v]+'</div>'+
        '<div class="verdict-sub">'+dm.sub[v]+'</div>'+
        '<div class="verdict-code">'+dm.code[v]+' ¬∑ '+dm.range[v]+'</div>'+
      '</div>'+
    '</div>'+
    /* TIMESTAMP ‚Äî UI only */
    '<div class="checked-time">'+formatTime()+' ¬∑ Based on known risk signals</div>'+
    /* 2. HASHCHAIN ‚Äî always visible */
    '<div class="hash-strip">'+
      '<div class="hash-strip-top">'+
        '<span class="hash-lock">üîí</span>'+
        '<span class="hash-title">'+dm.hashTitle+ver+'</span>'+
        '<span class="hash-what" onclick="openModal(\'hash-modal\')">'+dm.hashLearn+'</span>'+
      '</div>'+
      '<div class="hash-mono-row">'+
        '<span class="hash-mono-val">'+hash+'</span>'+
        '<button class="hash-copy-btn" onclick="copyHash()" title="'+dm.hashCopy+'">üìã</button>'+
      '</div>'+
      '<button class="hash-verify-btn" onclick="openVerifyModal()">üîç '+dm.hashVerify+'</button>'+
      '<div class="inline-verify-result" id="inline-verify-result"></div>'+
    '</div>'+
    /* 3. DISCLAIMER */
    '<div class="result-disc v'+v+'-disc">'+dm.disc2+'</div>'+
    /* 4. SUMMARY */
    '<div class="summary">'+dm.summary[v]+'</div>'+
    /* 5. SIGNAL BREAKDOWN */
    '<div class="signals-wrap">'+
      '<div class="section-title">SIGNAL BREAKDOWN</div>'+
      '<div class="signals-grid">'+sigHTML+'</div>'+sigDef+
    '</div>'+
    /* 6. SIGNAL STRENGTH */
    '<div class="conf-wrap">'+
      '<div class="conf-top"><span>SIGNAL STRENGTH</span><span class="conf-pct v'+v+'-name">'+score+'</span></div>'+
      '<div class="conf-track"><div class="conf-fill v'+v+'-fill" id="conf-fill"></div></div>'+
      '<div class="conf-band v'+v+'-band">'+band+'</div>'+
      '<div class="conf-note">'+dm.confNote+'</div>'+
    '</div>'+
    /* 7. MATCHED PATTERNS */
    '<div class="rules-wrap">'+
      '<div class="collapsible-hdr" onclick="toggleSec(\'ra\',\'rb\')"><span class="caret" id="ra">‚ñ∂</span> '+dm.ruleHdr+'</div>'+
      '<div class="collapsible-body" id="rb">'+rulesHTML+'</div>'+
    '</div>'+
    /* 8. ACTIONS */
    '<div class="actions-wrap">'+
      '<div class="action-btns">'+
        '<button class="act-btn btn-share" onclick="shareResult()">'+dm.share+'</button>'+
        '<button class="act-btn btn-copy" onclick="copyProof()">'+dm.copy+'</button>'+
      '</div>'+
      '<button class="btn-verify-proof" onclick="openVerifyModal()">üîç '+dm.verifyProof+'</button>'+
      '<div class="action-note">'+dm.actNote+'</div>'+
    '</div>'+
    /* 9. SAFE NOTICE */
    '<div class="safe-notice">'+dm.safeNotice+'</div>'+
    /* 10. FEEDBACK */
    '<div class="fb-wrap">'+
      '<span class="fb-lbl">'+dm.fbLbl+'</span>'+
      '<button class="fb-btn" id="fb-yes" onclick="giveFb(\'yes\')">'+dm.fbYes+'</button>'+
      '<button class="fb-btn" id="fb-no" onclick="giveFb(\'no\')">'+dm.fbNo+'</button>'+
      '<span class="fb-thanks" id="fb-thanks">'+dm.fbThanks+'</span>'+
    '</div>';

  document.getElementById('result-card').style.display='block';
  setTimeout(()=>{const f=document.getElementById('conf-fill');if(f)f.style.width=Math.min(score,100)+'%';},100);
  document.getElementById('result-card').scrollIntoView({behavior:'smooth',block:'nearest'});
}

/* ‚ïê‚ïê BUILD PROOF ‚ïê‚ïê */
function buildProof(){
  if(!lastResult) return '';
  const r=lastResult;const dm=DM[lang];
  const v=r.decision!==undefined?r.decision:0;
  const payload={decision:r.decision,intent:r.intent,fired_rules:r.fired_rules||[],score:r.score||0,hash:r.hash};
  return 'VERITAS GUARD ‚Äî RISK ANALYSIS\n'+
    '================================\n'+
    'Verdict : '+dm.label[v]+'\n'+
    'Decision: '+dm.code[v]+'\n'+
    'Score   : '+(r.score||0)+'\n'+
    'Intent  : '+(r.intent||'UNKNOWN')+'\n'+
    'Rules   : '+((r.fired_rules||[]).join(', ')||'None')+'\n'+
    'Hash    : '+(r.hash||'pending')+'\n'+
    'Engine  : '+(engineVersion||'v1.5')+' ¬∑ RULES FROZEN\n'+
    '================================\n'+
    'NOTE: Risk patterns only ‚Äî not a fraud verdict.\n'+
    'Verify: '+ENGINE_BASE+'/verify\n\n'+
    'RAW_PROOF:'+JSON.stringify(payload);
}

function copyProof(){const t=buildProof();if(!t)return;navigator.clipboard.writeText(t).then(()=>showToast(DM[lang].toastCopy));}
function shareResult(){const t=buildProof();if(!t)return;if(navigator.share)navigator.share({title:'Veritas Guard',text:t});else copyProof();}
function copyHash(){if(!lastHash)return;navigator.clipboard.writeText(lastHash).then(()=>showToast(DM[lang].hashCopied));}

/* ‚ïê‚ïê VERIFY PROOF MODAL ‚ïê‚ïê */
function openVerifyModal(){
  document.getElementById('verify-res').className='verify-res';
  document.getElementById('verify-res').innerHTML='';
  document.getElementById('verify-raw').className='verify-raw';
  document.getElementById('verify-raw').innerHTML='';
  document.getElementById('verify-adv').className='verify-adv';
  document.getElementById('verify-ta').value='';
  openModal('verify-modal');
}

async function doVerify(){
  const raw=document.getElementById('verify-ta').value.trim();
  if(!raw) return;
  const btn=document.getElementById('verify-btn-modal');
  const res=document.getElementById('verify-res');
  const adv=document.getElementById('verify-adv');
  const rawEl=document.getElementById('verify-raw');
  btn.disabled=true;btn.textContent='‚ü≥ Verifying...';
  res.className='verify-res';res.innerHTML='';
  adv.className='verify-adv';rawEl.className='verify-raw';

  try{
    // Parse ‚Äî try JSON first, then RAW_PROOF embedded text
    let proof=null;
    try{proof=JSON.parse(raw);}catch(e){}
    if(!proof){
      const m=raw.match(/RAW_PROOF:(\{[\s\S]+\})/);
      if(m){try{proof=JSON.parse(m[1]);}catch(e){}}
    }
    if(!proof||!proof.hash){
      res.className='verify-res warn show';
      res.innerHTML='‚ö† Could not read proof.<br>Paste the full text from COPY PROOF button.';
      return;
    }
    // Canonical payload ‚Äî NO timestamp, only engine fields
    const payload={
      decision:   proof.decision,
      intent:     proof.intent,
      fired_rules:proof.fired_rules||[],
      score:      proof.score||0,
      hash:       proof.hash
    };
    const r=await fetch(ENGINE_BASE+'/verify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
    if(!r.ok) throw new Error('engine');
    const d=await r.json();
    if(d.valid){
      res.className='verify-res valid show';
      res.innerHTML='‚úÖ <strong>Proof is authentic and unmodified.</strong><br>'+
        'Decision: '+proof.decision+' ¬∑ Score: '+proof.score+' ¬∑ Intent: '+(proof.intent||'‚Äî');
      adv.className='verify-adv show';
      rawEl.innerHTML='Hash: '+proof.hash;
    }else{
      res.className='verify-res invalid show';
      res.innerHTML='‚ùå <strong>Proof does not match.</strong><br>Data may have been altered.';
      adv.className='verify-adv show';
      rawEl.innerHTML='Submitted: '+(d.submitted||'‚Äî');
    }
  }catch(e){
    res.className='verify-res warn show';
    res.innerHTML='‚ö† Engine unreachable ‚Äî cannot verify now.<br>Try when engine is online.';
  }finally{
    btn.disabled=false;btn.textContent='‚ö° VERIFY';
  }
}

function toggleVerifyRaw(){document.getElementById('verify-raw').classList.toggle('show');}

/* ‚ïê‚ïê HELPERS ‚ïê‚ïê */
function toggleSec(ca,ba){const c=document.getElementById(ca);const b=document.getElementById(ba);if(c)c.classList.toggle('open');if(b)b.classList.toggle('open');}
function giveFb(t){const y=document.getElementById('fb-yes');const n=document.getElementById('fb-no');const th=document.getElementById('fb-thanks');if(!y||!n)return;y.disabled=true;n.disabled=true;y.classList.toggle('sel',t==='yes');n.classList.toggle('sel',t==='no');if(th)th.classList.add('show');}
function showToast(m){const el=document.getElementById('toast');el.textContent=m;el.classList.add('show');setTimeout(()=>el.classList.remove('show'),3000);}
function openModal(id){document.getElementById(id).classList.add('show');}
function closeModal(id){document.getElementById(id).classList.remove('show');}
function showInfoModal(){openModal('info-modal');}
function loadEx(i){const inp=document.getElementById('input-text');inp.value=EXAMPLES[i];document.getElementById('char-val').textContent=EXAMPLES[i].length;inp.focus();}

/* ‚ïê‚ïê IMAGE OCR ‚ïê‚ïê */
function setImgStatus(msg,type){const el=document.getElementById('img-status');el.textContent=msg;el.className='img-status '+(type||'');}
function setProgress(pct){const b=document.getElementById('prog-bar');if(b)b.style.width=pct+'%';}

function smartClean(raw){
  const lines=raw.split('\n');const out=[];
  for(let line of lines){
    let l=line.trim();if(!l)continue;
    l=l.replace(/\b\d{1,2}:\d{2}(:\d{2})?\s*(AM|PM|am|pm)?\b/g,'');
    l=l.replace(/\b(Mon|Tue|Wed|Thu|Fri|Sat|Sun|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)\b/gi,'');
    l=l.replace(/\b\d{1,2}[/-]\d{1,2}[/-]\d{2,4}\b/g,'');
    l=l.replace(/\b(battery|signal|wifi|bluetooth|charging|\d+%|\d+G|LTE|5G|4G|3G|2G|VoLTE)\b/gi,'');
    if(/^(airtel|jio|vi|vodafone|idea|bsnl|mtnl)$/i.test(l.trim()))continue;
    if(l.replace(/[^a-zA-Z\u0900-\u097F]/g,'').length<3)continue;
    if(/^(Read|Delivered|Sent|Seen|Yesterday|Today|Just now)$/i.test(l.trim()))continue;
    l=l.replace(/[ \t]+/g,' ').trim();
    if(l.length>1)out.push(l);
  }
  const result=out.join(' ').replace(/\s{2,}/g,' ').trim();
  return result.length>10?result:raw.replace(/[ \t]+/g,' ').trim();
}

async function handleImage(event){
  const file=event.target.files[0];if(!file)return;
  const reader=new FileReader();
  reader.onload=async(e)=>{
    const src=e.target.result;
    document.getElementById('img-preview').src=src;
    document.getElementById('img-filename').textContent=file.name.length>20?file.name.slice(0,18)+'...':file.name;
    document.getElementById('img-preview-wrap').classList.add('show');
    document.getElementById('img-btn-text').textContent=lang==='hi'?'‡§¨‡§¶‡§≤‡•á‡§Ç':'Change';
    setProgress(0);setImgStatus(lang==='hi'?'üì§ ‡§Ö‡§™‡§≤‡•ã‡§°...':'üì§ Uploading...','');
    await new Promise(r=>setTimeout(r,300));
    setImgStatus(lang==='hi'?'üîç ‡§™‡§¢‡§º‡§æ ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à...':'üîç Reading...','');setProgress(20);
    try{
      const{data:{text}}=await Tesseract.recognize(src,'eng+hin',{logger:m=>{if(m.status==='recognizing text')setProgress(20+Math.round((m.progress||0)*70));}});
      setProgress(90);const cleaned=smartClean(text);setProgress(100);
      if(cleaned&&cleaned.length>3){
        document.getElementById('input-text').value=cleaned;
        document.getElementById('char-val').textContent=cleaned.length;
        setImgStatus(lang==='hi'?'‚úÖ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ':'‚úÖ Text copied to box','ok');
      }else{setImgStatus(lang==='hi'?'‚ö† ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ':'‚ö† No text found','warn');}
    }catch(e){setImgStatus(lang==='hi'?'‚ö† ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‚Äî ‡§Æ‡•à‡§®‡•ç‡§Ø‡•Å‡§Ö‡§≤ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç':'‚ö† Error ‚Äî type manually','warn');}
  };
  reader.readAsDataURL(file);
}

function clearImage(){
  document.getElementById('img-preview-wrap').classList.remove('show');
  document.getElementById('img-preview').src='';document.getElementById('img-input').value='';
  document.getElementById('img-filename').textContent='';setImgStatus('','');setProgress(0);
  document.getElementById('img-btn-text').textContent=lang==='hi'?'‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§Ö‡§™‡§≤‡•ã‡§°':'Upload Screenshot';
}

/* ‚ïê‚ïê DEV BYPASS ‚ïê‚ïê */
document.addEventListener('input',e=>{
  if(e.target.id==='input-text'&&e.target.value.trim()===DEV_CODE){
    const d=getRD();d.used=0;saveRD(d);e.target.value='';
    document.getElementById('char-val').textContent='0';
    renderRate();showToast('‚úÖ Dev: Limit reset!');
  }
});

/* ‚ïê‚ïê LANG ‚ïê‚ïê */
function setLang(l){lang=l;localStorage.setItem('vg_lang',l);applyLang();}
function applyLang(){
  const t=TXT[lang];
  const map={'tagline-text':t.tagline,'lbl-usecase':t.lblUsecase,'lbl-input':t.lblInput,'btn-text':t.btnText,'nd1':t.nd1,'nd2':t.nd2,'nd3':t.nd3,'lbl-total':t.lbl_total,'lbl-today':t.lbl_today,'disc-title':t.discTitle,'disc-body':t.discBody,'how-title':t.howTitle,'how1':t.how1,'how2':t.how2,'how3':t.how3,'how4':t.how4,'ex-title':t.exTitle,'ex-sub':t.exSub,'ex1':t.ex1,'ex2':t.ex2,'ex3':t.ex3};
  for(const[id,val]of Object.entries(map)){const el=document.getElementById(id);if(el)el.textContent=val;}
  const lt=document.getElementById('limit-text');if(lt)lt.innerHTML=t.limitText;
  const lt2=document.getElementById('limit-title');if(lt2)lt2.textContent=t.limitTitle;
  document.getElementById('input-text').placeholder=lang==='hi'?'SMS, WhatsApp ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§æ ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§ö‡§ø‡§™‡§ï‡§æ‡§è‡§Å...':'Paste SMS, WhatsApp message, or link here...';
  document.querySelectorAll('#usecase option').forEach(o=>{o.textContent=lang==='hi'?o.dataset.hi:o.dataset.en;});
  document.getElementById('btn-en').classList.toggle('active',lang==='en');
  document.getElementById('btn-hi').classList.toggle('active',lang==='hi');
  const imgBtn=document.getElementById('img-btn-text');
  if(imgBtn&&!document.getElementById('img-preview-wrap').classList.contains('show'))imgBtn.textContent=lang==='hi'?'‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®‡§∂‡•â‡§ü ‡§Ö‡§™‡§≤‡•ã‡§°':'Upload Screenshot';
  const vta=document.getElementById('verify-ta');
  if(vta)vta.placeholder=lang==='hi'?'‡§Ø‡§π‡§æ‡§Å ‡§™‡•ç‡§∞‡•Ç‡§´ ‡§ü‡•á‡§ï‡•ç‡§∏‡•ç‡§ü ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç...':'Paste proof text here...\n(from COPY PROOF button)';
  renderRate();
}

/* ‚ïê‚ïê INIT ‚ïê‚ïê */
document.addEventListener('DOMContentLoaded',()=>{
  document.getElementById('input-text').addEventListener('input',function(){document.getElementById('char-val').textContent=this.value.length;});
  document.getElementById('clear-btn').addEventListener('click',()=>{
    document.getElementById('input-text').value='';document.getElementById('char-val').textContent='0';
    document.getElementById('result-card').style.display='none';lastResult=null;lastHash='';
  });
  // Close modal on overlay click
  document.querySelectorAll('.modal-overlay').forEach(el=>{
    el.addEventListener('click',e=>{if(e.target===el)el.classList.remove('show');});
  });
  applyLang();renderStats();checkHealth();
});
</script>
</body>
</html>
