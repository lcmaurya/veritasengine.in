<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Cache-Control" content="no-store" />
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Veritas Guard</title>

<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ°Ô∏è</text></svg>">

<style>
body {
  margin:0; font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:#0b1220; color:#e5e7eb;
}
#legal-marquee {
  background:#7c2d12; color:#fff; padding:8px 0; font-size:14px;
}
#app {
  max-width:480px; margin:40px auto; background:#0f172a;
  border-radius:12px; padding:20px; box-shadow:0 0 40px rgba(0,0,0,.5);
}
h1 { text-align:center; margin:0 0 6px; }
.tagline { text-align:center; font-size:13px; color:#9ca3af; }

/* üåü Feature 2: Neon Glow on Focus */
textarea {
  width:100%; height:100px; margin-top:16px; border-radius:8px;
  border:1px solid #334155; padding:12px; background:#020617; color:#e5e7eb;
  box-sizing: border-box; resize: none;
  transition: all 0.3s ease;
}
textarea:focus {
  outline: none;
  border-color: #3b82f6;
  box-shadow: 0 0 15px rgba(59, 130, 246, 0.4);
}

.btn-primary {
  width:100%; margin-top:12px; padding:14px; border:none; cursor:pointer;
  border-radius:8px; background:#2563eb; color:white; font-size:16px; font-weight:bold;
  transition: background 0.2s ease;
}
.btn-primary:hover { background: #1d4ed8; }
.btn-primary:active { transform: scale(0.98); }

.notice { margin-top:10px; font-size:12px; color:#9ca3af; text-align: center; }
details { margin-top:14px; background:#020617; padding:12px; border-radius:8px; font-size:13px; border: 1px solid #1e293b;}
footer { margin-top:30px; text-align:center; font-size:12px; color:#6b7280; margin-bottom: 20px;}
.lang-btn { padding:6px 12px; margin-left:4px; border-radius:6px; font-size:13px; border:none; cursor:pointer; background:#3b82f6; color:white;}

/* üåü Feature 3: Smooth Fade-In Animation */
@keyframes fadeInSlideUp {
  from { opacity: 0; transform: translateY(15px); }
  to { opacity: 1; transform: translateY(0); }
}

#resultSection { 
  display: none; margin-top: 20px; background: #1e293b; padding: 15px; 
  border-radius: 8px; border: 1px solid #334155;
  animation: fadeInSlideUp 0.4s ease-out;
}

.risk-badge { display: inline-block; padding: 6px 12px; border-radius: 4px; font-weight: bold; font-size: 14px; margin-bottom: 10px; }
.explanation { font-size: 14px; margin-bottom: 12px; line-height:1.5; }
.signals-list { margin: 0; padding-left: 20px; color: #9ca3af; font-size: 13px; }
.hash-display { margin-top: 12px; font-family: monospace; font-size: 10px; color: #64748b; word-break: break-all; background: #020617; padding: 8px; border-radius: 4px; border: 1px dashed #334155;}

/* Action Buttons */
.action-row { display: flex; gap: 10px; margin-top: 15px; }
.action-btn { flex: 1; padding: 10px; border: none; border-radius: 6px; font-size: 13px; cursor: pointer; font-weight: bold; transition: opacity 0.2s ease; }
.action-btn:active { transform: scale(0.95); }
.btn-share { background: #10b981; color: white; }
.btn-clear { background: #ef4444; color: white; }
.btn-voice { background: #f59e0b; color: white; }

/* History Section */
.history-section { margin-top: 20px; font-size: 13px; animation: fadeInSlideUp 0.5s ease-out; }
.history-item { background: #020617; padding: 8px; border-radius: 6px; margin-top: 8px; border-left: 3px solid gray; color: #9ca3af; display: flex; justify-content: space-between; border: 1px solid #1e293b;}
</style>
</head>

<body>

<div style="position:fixed;top:12px;right:12px;z-index:9999;">
  <button class="lang-btn" onclick="applyLang('en')">EN</button>
  <button class="lang-btn" onclick="applyLang('hi')">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
</div>

<marquee id="legal-marquee"></marquee>

<div id="app">
  <h1>üõ°Ô∏è Veritas Guard</h1>
  <div class="tagline" id="tagline"></div>

  <textarea id="input-text"></textarea>
  <button class="btn-primary" id="main-btn" onclick="analyzeText()"><span id="analyze-btn"></span></button>

  <div id="resultSection">
      <div id="riskBadge" class="risk-badge">SCANNING...</div>
      <div id="explainText" class="explanation"></div>
      <div style="font-size: 12px; color: #9ca3af; font-weight: bold; margin-bottom:4px;" id="signal-title">Triggered Signals:</div>
      <ul id="signalsList" class="signals-list"></ul>
      <div id="hashDisplay" class="hash-display"></div>
      
      <div class="action-row">
          <button class="action-btn btn-voice" onclick="playVoiceWarning()">üîä <span id="btn-voice-txt">Listen</span></button>
          <button class="action-btn btn-share" onclick="shareResult()">üì≤ <span id="btn-share-txt">Share</span></button>
          <button class="action-btn btn-clear" onclick="clearApp()">üóëÔ∏è <span id="btn-clear-txt">Clear</span></button>
      </div>
  </div>

  <div class="notice">üîí No Login ¬∑ No Permissions ¬∑ No Data Stored</div>

  <details open>
    <summary><b id="legal-title"></b></summary>
    <div id="legal-text"></div>
  </details>

  <div class="history-section" id="historyBox" style="display:none;">
      <b id="history-title" style="color:#e5e7eb;">Recent Scans (Saved Locally)</b>
      <div id="historyList"></div>
  </div>
</div>

<footer>
  ¬© Veritas Engine ‚Äî Open Risk Awareness Tool<br/>
  No charges. No guarantees. No liability.
</footer>

<script>
const I18N = {
  en:{
    tagline:"Explain risk. Don‚Äôt demand trust.", placeholder:"Paste SMS, WhatsApp message, or link here...", button:"Analyze Risk Signals",
    marquee:"‚ö†Ô∏è This tool analyzes text for known risk patterns. It does NOT detect fraud, make decisions, or provide guarantees. Final responsibility remains with the user.",
    legalTitle:"Legal Disclaimer",
    legalText:`This tool analyzes text for commonly known risk patterns based on deterministic rules.<br><br>It does NOT guarantee fraud detection accuracy and does NOT make decisions for you.<br>Final responsibility always remains with the user.<br><br>This is NOT an AI system, NOT a fraud prevention service, and NOT a financial, banking, legal, or security advisory tool.<br><br>No personal data is collected, stored, transmitted, or shared.`,
    shareTxt: "Share", clearTxt: "Clear", listenTxt: "Listen", signalTitle: "Triggered Signals:", historyTitle: "Recent Scans (Saved Locally)",
    voiceWarning: "Warning! This message shows signs of a scam. Please do not click any links.",
    voiceSafe: "This message appears safe, but always stay alert."
  },
  hi:{
    tagline:"‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Æ‡§ù‡§æ‡§á‡§è‡•§ ‡§≠‡§∞‡•ã‡§∏‡§æ ‡§Æ‡§§ ‡§Æ‡§æ‡§Ç‡§ó‡§ø‡§è‡•§", placeholder:"SMS, WhatsApp ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§æ ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§°‡§æ‡§≤‡•á‡§Ç‚Ä¶", button:"‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§‡•ã‡§Ç ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡•á‡§Ç",
    marquee:"‚ö†Ô∏è ‡§Ø‡§π ‡§ü‡•Ç‡§≤ ‡§ï‡•á‡§µ‡§≤ ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§¶‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ú‡§º‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•Ä ‡§π‡•à‡•§",
    legalTitle:"‡§ï‡§æ‡§®‡•Ç‡§®‡•Ä ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§∞‡§£",
    legalText:`‡§Ø‡§π ‡§ü‡•Ç‡§≤ ‡§ï‡•á‡§µ‡§≤ ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§®‡§ø‡§Ø‡§Æ‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§<br><br>‡§Ø‡§π ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§ï‡•ã‡§à ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡§æ ‡§î‡§∞ ‡§ï‡•ã‡§à ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§≤‡•á‡§§‡§æ‡•§<br>‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§î‡§∞ ‡§ú‡§º‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä ‡§™‡•Ç‡§∞‡•Ä ‡§§‡§∞‡§π ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•Ä ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§<br><br>‡§Ø‡§π ‡§ï‡•ã‡§à AI ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§î‡§∞ ‡§® ‡§π‡•Ä ‡§ï‡•ã‡§à ‡§´‡•ç‡§∞‡•â‡§°, ‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó, ‡§ï‡§æ‡§®‡•Ç‡§®‡•Ä ‡§Ø‡§æ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ ‡§∏‡§≤‡§æ‡§π ‡§∏‡•á‡§µ‡§æ ‡§π‡•à‡•§<br><br>‡§ï‡•ã‡§à ‡§≠‡•Ä ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§°‡•á‡§ü‡§æ ‡§∏‡§Ç‡§ó‡•ç‡§∞‡§π‡§ø‡§§ ‡§Ø‡§æ ‡§∏‡§æ‡§ù‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ‡•§`,
    shareTxt: "‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç", clearTxt: "‡§∏‡§æ‡§´‡§º ‡§ï‡§∞‡•á‡§Ç", listenTxt: "‡§∏‡•Å‡§®‡•á", signalTitle: "‡§ñ‡§§‡§∞‡•á ‡§ï‡•á ‡§∏‡§Ç‡§ï‡•á‡§§:", historyTitle: "‡§π‡§æ‡§≤ ‡§ï‡•á ‡§∏‡•ç‡§ï‡•à‡§® (‡§≤‡•ã‡§ï‡§≤ ‡§∏‡•á‡§µ‡•ç‡§°)",
    voiceWarning: "‡§∏‡§æ‡§µ‡§ß‡§æ‡§®! ‡§Ø‡§π ‡§è‡§ï ‡§´‡§∞‡•ç‡§ú‡•Ä ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§π‡•ã ‡§∏‡§ï‡§§‡§æ ‡§π‡•à‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡§ø‡§∏‡•Ä ‡§≠‡•Ä ‡§≤‡§ø‡§Ç‡§ï ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§",
    voiceSafe: "‡§Ø‡§π ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§™‡•ç‡§∞‡§§‡•Ä‡§§ ‡§π‡•ã‡§§‡§æ ‡§π‡•à, ‡§´‡§ø‡§∞ ‡§≠‡•Ä ‡§∏‡§§‡§∞‡•ç‡§ï ‡§∞‡§π‡•á‡§Ç‡•§"
  }
};

let currentLang = "en";
let currentRiskLevel = 0; 
let currentHash = "";

const riskConfig = {
    0: { color: "#10b981", bg: "rgba(16, 185, 129, 0.1)" }, 
    1: { color: "#eab308", bg: "rgba(234, 179, 8, 0.1)" },  
    2: { color: "#f97316", bg: "rgba(249, 115, 22, 0.1)" }, 
    3: { color: "#ef4444", bg: "rgba(239, 68, 68, 0.1)" }   
};

function applyLang(lang){
  currentLang = lang;
  localStorage.setItem("veritas_lang", lang);
  document.getElementById("tagline").innerText = I18N[lang].tagline;
  document.getElementById("input-text").placeholder = I18N[lang].placeholder;
  document.getElementById("analyze-btn").innerText = I18N[lang].button;
  document.getElementById("legal-title").innerText = I18N[lang].legalTitle;
  document.getElementById("legal-text").innerHTML = I18N[lang].legalText;
  document.getElementById("legal-marquee").innerText = I18N[lang].marquee;
  document.getElementById("btn-share-txt").innerText = I18N[lang].shareTxt;
  document.getElementById("btn-clear-txt").innerText = I18N[lang].clearTxt;
  document.getElementById("btn-voice-txt").innerText = I18N[lang].listenTxt;
  document.getElementById("signal-title").innerText = I18N[lang].signalTitle;
  document.getElementById("history-title").innerText = I18N[lang].historyTitle;
  renderHistory();
}

document.addEventListener("DOMContentLoaded",()=>{
  applyLang(localStorage.getItem("veritas_lang") || "en");
});

async function analyzeText() {
    let rawInput = document.getElementById('input-text').value.trim();
    if(!rawInput) return;

    let maskedInput = rawInput.replace(/\b\d{8,14}\b/g, (match) => "X".repeat(match.length - 4) + match.slice(-4));
    
    const mainBtn = document.getElementById('main-btn');
    const resultSec = document.getElementById('resultSection');
    
    // Reset animation hack
    resultSec.style.animation = 'none';
    resultSec.offsetHeight; // trigger reflow
    resultSec.style.animation = null; 

    mainBtn.disabled = true; 
    mainBtn.style.opacity = "0.5";
    resultSec.style.display = "none";

    try {
        // ‚ö†Ô∏è API ENDPOINT: (Update this when your VPS is ready!)
        const API_URL = "http://127.0.0.1:3000/api/scan"; 
        
        const response = await fetch(API_URL, {
            method: "POST", 
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text: maskedInput }) 
        });
        
        const engineData = await response.json();
        currentRiskLevel = engineData.verdict;
        currentHash = engineData.audit_hash;
        
        const conf = riskConfig[currentRiskLevel];
        const badge = document.getElementById('riskBadge');
        const riskLabels = ["SAFE", "NEEDS ATTENTION", "RISK", "HIGH RISK"];
        badge.innerText = riskLabels[currentRiskLevel];
        badge.style.color = conf.color; 
        badge.style.backgroundColor = conf.bg; 
        badge.style.border = `1px solid ${conf.color}`;
        
        document.getElementById('explainText').innerText = engineData.explain_text;
        
        const list = document.getElementById('signalsList');
        list.innerHTML = "";
        if(engineData.fired_rules && engineData.fired_rules.length > 0) {
            engineData.fired_rules.forEach(rule => { 
                list.innerHTML += `<li>${rule.replace(/_/g, " ")}</li>`; 
            });
        } else {
            list.innerHTML = "<li>No specific risk patterns found.</li>";
        }
        
        document.getElementById('hashDisplay').innerText = "Audit Hash: " + currentHash;
        resultSec.style.display = "block"; // This triggers the fade-in!

        saveHistory(maskedInput, riskLabels[currentRiskLevel], conf.color);
        
        if(currentRiskLevel >= 2) playVoiceWarning();

    } catch (e) {
        console.error("API Error:", e);
        alert("Engine is unreachable. Please ensure the backend is running.");
    } finally {
        mainBtn.disabled = false; 
        mainBtn.style.opacity = "1";
    }
}

function playVoiceWarning() {
    window.speechSynthesis.cancel(); 
    const msg = currentRiskLevel >= 2 ? I18N[currentLang].voiceWarning : I18N[currentLang].voiceSafe;
    const utterance = new SpeechSynthesisUtterance(msg);
    utterance.lang = currentLang === 'hi' ? 'hi-IN' : 'en-US';
    utterance.rate = 0.9; 
    window.speechSynthesis.speak(utterance);
}

function shareResult() {
    const text = `*Veritas Guard Alert*\nRisk Level: ${currentRiskLevel >= 2 ? 'üö® HIGH RISK' : '‚úÖ SAFE'}\nAudit Hash: ${currentHash}\n\nChecked via: veritasengine.in`;
    if (navigator.share) {
        navigator.share({ title: 'Veritas Guard Scan', text: text });
    } else {
        window.open(`https://api.whatsapp.com/send?text=${encodeURIComponent(text)}`);
    }
}

function clearApp() {
    document.getElementById('input-text').value = "";
    document.getElementById('resultSection').style.display = "none";
    window.speechSynthesis.cancel();
}

function saveHistory(text, badgeLabel, color) {
    let hist = JSON.parse(localStorage.getItem('veritas_history') || '[]');
    let snippet = text.substring(0, 25).replace(/\n/g, " ") + "...";
    hist.unshift({ text: snippet, badge: badgeLabel, color: color });
    if(hist.length > 3) hist.pop(); 
    localStorage.setItem('veritas_history', JSON.stringify(hist));
    renderHistory();
}

function renderHistory() {
    let hist = JSON.parse(localStorage.getItem('veritas_history') || '[]');
    const box = document.getElementById('historyBox');
    const list = document.getElementById('historyList');
    list.innerHTML = "";
    
    if(hist.length === 0) {
        box.style.display = "none";
        return;
    }
    box.style.display = "block";
    hist.forEach(item => {
        list.innerHTML += `<div class="history-item"><span>${item.text}</span> <strong style="color:${item.color}; font-size:11px;">${item.badge}</strong></div>`;
    });
}
</script>

</body>
</html>
