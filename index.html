<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Veritas Guard</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap');
:root{--bg:#060910;--surface:#0d1117;--border:#1e2d3d;--accent:#00d4ff;--accent2:#ff4d6d;--accent3:#00ff9d;--text:#c9d1d9;--muted:#586069;--v0:#00ff9d;--v1:#ffaa00;--v2:#ff7043;--v3:#ff4d6d}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Syne',sans-serif;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,212,255,.03) 1px,transparent 1px),linear-gradient(90deg,rgba(0,212,255,.03) 1px,transparent 1px);background-size:40px 40px;pointer-events:none;z-index:0}
#warning-bar{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(255,77,109,.25);border-bottom:2px solid rgba(255,77,109,.6);padding:8px 0;font-family:'Space Mono',monospace;font-size:13px;color:#fff;overflow:hidden;backdrop-filter:blur(10px)}
#warn-text{display:inline-block;white-space:nowrap;animation:marquee 20s linear infinite;padding-left:100%}
@keyframes marquee{0%{transform:translateX(0)}100%{transform:translateX(-200%)}}
#app{position:relative;z-index:1;max-width:480px;margin:0 auto;padding:70px 16px 40px}
.header{text-align:center;padding:24px 0 20px}
.logo{display:inline-flex;align-items:center;gap:10px;margin-bottom:8px}
.logo-icon{width:42px;height:42px;background:linear-gradient(135deg,var(--accent),#0051ff);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 0 20px rgba(0,212,255,.3)}
.logo-text{font-size:26px;font-weight:800;background:linear-gradient(90deg,var(--accent),#fff);-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.tagline{font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);letter-spacing:2px;text-transform:uppercase}
.stats-bar{display:flex;justify-content:center;gap:20px;margin:16px 0 20px;padding:12px;background:var(--surface);border:1px solid var(--border);border-radius:10px}
.stat{text-align:center}
.stat-val{font-family:'Space Mono',monospace;font-size:15px;font-weight:700;color:var(--accent)}
.stat-label{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px}
.card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:20px;margin-bottom:12px}
.lang-toggle{display:flex;gap:6px;margin-bottom:14px}
.lang-btn{flex:1;padding:8px;background:transparent;border:1px solid var(--border);border-radius:6px;color:var(--muted);font-family:'Space Mono',monospace;font-size:12px;cursor:pointer;transition:all .2s}
.lang-btn.active{background:rgba(0,212,255,.1);border-color:var(--accent);color:var(--accent)}
.field-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px;font-family:'Space Mono',monospace}
select{width:100%;padding:10px 12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Syne',sans-serif;font-size:14px;margin-bottom:14px;outline:none}
select:focus{border-color:var(--accent)}
textarea{width:100%;height:100px;padding:12px;background:var(--bg);border:1px solid var(--border);border-radius:8px;color:var(--text);font-family:'Space Mono',monospace;font-size:12px;resize:none;outline:none;line-height:1.6}
textarea:focus{border-color:var(--accent)}
textarea::placeholder{color:var(--muted)}
.char-row{display:flex;justify-content:space-between;align-items:center;margin-top:4px;margin-bottom:14px}
.clear-btn{background:transparent;border:1px solid var(--border);color:var(--muted);padding:3px 10px;border-radius:5px;font-size:11px;cursor:pointer;font-family:'Space Mono',monospace}
.char-count{font-family:'Space Mono',monospace;font-size:10px;color:var(--muted)}
#analyze-btn{width:100%;padding:14px;background:linear-gradient(135deg,var(--accent),#0051ff);border:none;border-radius:8px;color:#000;font-family:'Syne',sans-serif;font-weight:800;font-size:15px;letter-spacing:1px;cursor:pointer;transition:all .2s}
#analyze-btn:hover{transform:translateY(-1px);box-shadow:0 8px 24px rgba(0,212,255,.3)}
#analyze-btn.loading{pointer-events:none;opacity:.7}
.no-data{display:flex;justify-content:center;gap:16px;margin-top:12px;font-family:'Space Mono',monospace;font-size:10px;color:var(--muted)}
.no-data span::before{content:'‚úì ';color:var(--accent3)}
#result-card{display:none;background:var(--surface);border-radius:12px;overflow:hidden;margin-bottom:12px;animation:slideIn .3s ease}
@keyframes slideIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.result-header{padding:16px 20px;display:flex;align-items:center;gap:12px}
.verdict-icon{width:48px;height:48px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.verdict-text h3{font-size:18px;font-weight:800}
.verdict-text p{font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);margin-top:2px}
.conf-section{padding:0 20px 14px}
.conf-label{display:flex;justify-content:space-between;font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);margin-bottom:6px}
.conf-bar{height:6px;background:var(--border);border-radius:3px;overflow:hidden}
.conf-fill{height:100%;border-radius:3px;transition:width .8s cubic-bezier(.4,0,.2,1);width:0%}
.reasons-section{padding:0 20px 16px}
.reasons-title{font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.reason-tag{display:inline-block;padding:4px 10px;border-radius:20px;font-family:'Space Mono',monospace;font-size:10px;margin:3px 3px 3px 0;border:1px solid}
.hash-section{padding:12px 20px;background:rgba(0,0,0,.3);border-top:1px solid var(--border)}
.hash-row{display:flex;justify-content:space-between;align-items:flex-start;font-family:'Space Mono',monospace;font-size:10px;margin-bottom:6px}
.hash-key{color:var(--muted);flex-shrink:0;margin-right:8px}
.hash-val{color:var(--accent);word-break:break-all;text-align:right}
.share-section{padding:14px 20px;border-top:1px solid var(--border)}
.share-title{font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px}
.share-btns{display:flex;gap:8px;flex-wrap:wrap}
.share-btn{flex:1;min-width:80px;padding:9px 8px;background:transparent;border:1px solid var(--border);border-radius:7px;color:var(--text);font-family:'Space Mono',monospace;font-size:11px;cursor:pointer}
.share-btn.primary{background:rgba(0,212,255,.1);border-color:var(--accent);color:var(--accent)}
.disclaimer{background:var(--surface);border:1px solid var(--border);border-radius:12px;overflow:hidden;margin-bottom:12px}
.disclaimer summary{padding:12px 16px;font-family:'Space Mono',monospace;font-size:11px;color:var(--muted);cursor:pointer;list-style:none;display:flex;justify-content:space-between}
.disclaimer summary::after{content:'‚Üì'}
.disclaimer[open] summary::after{content:'‚Üë'}
.disclaimer-body{padding:12px 16px 14px;font-size:12px;color:var(--muted);line-height:1.7;border-top:1px solid var(--border)}
footer{text-align:center;font-family:'Space Mono',monospace;font-size:10px;color:var(--muted);padding-bottom:20px}
footer span{color:var(--accent)}
.c0{color:var(--v0);border-color:rgba(0,255,157,.3);background:rgba(0,255,157,.08)}
.c1{color:var(--v1);border-color:rgba(255,170,0,.3);background:rgba(255,170,0,.08)}
.c2{color:var(--v2);border-color:rgba(255,112,67,.3);background:rgba(255,112,67,.08)}
.c3{color:var(--v3);border-color:rgba(255,77,109,.3);background:rgba(255,77,109,.08)}
.bg0{background:rgba(0,255,157,.12)}.bg1{background:rgba(255,170,0,.12)}.bg2{background:rgba(255,112,67,.12)}.bg3{background:rgba(255,77,109,.12)}
.fill0{background:var(--v0)}.fill1{background:var(--v1)}.fill2{background:var(--v2)}.fill3{background:var(--v3)}
</style>
</head>
<body>

<div id="warning-bar">
  <span id="warn-text">‚ö† This tool analyzes text for known risk patterns. It does NOT confirm fraud. Final responsibility remains with the user.</span>
</div>

<div id="app">
  <div class="header">
    <div class="logo">
      <div class="logo-icon">üõ°Ô∏è</div>
      <div class="logo-text">Veritas Guard</div>
    </div>
    <div class="tagline" id="tagline-text">EXPLAIN RISK ¬∑ DON'T DEMAND TRUST</div>
  </div>

  <div class="stats-bar">
    <div class="stat"><div class="stat-val" id="stat-scanned">0</div><div class="stat-label" id="lbl-scanned">Scanned</div></div>
    <div class="stat"><div class="stat-val" id="stat-flagged">0</div><div class="stat-label" id="lbl-flagged">Flagged</div></div>
    <div class="stat"><div class="stat-val">v1.0</div><div class="stat-label">Engine</div></div>
  </div>

  <div class="card">
    <div class="lang-toggle">
      <button class="lang-btn active" id="btn-en">EN</button>
      <button class="lang-btn" id="btn-hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
    </div>
    <div class="field-label" id="lbl-usecase">USE CASE</div>
    <select id="usecase">
      <option value="cyber" data-en="Cyber / Fraud" data-hi="‡§∏‡§æ‡§á‡§¨‡§∞ / ‡§´‡•ç‡§∞‡•â‡§°">Cyber / Fraud</option>
      <option value="banking" data-en="Banking / Fintech" data-hi="‡§¨‡•à‡§Ç‡§ï‡§ø‡§Ç‡§ó / ‡§´‡§ø‡§®‡§ü‡•á‡§ï">Banking / Fintech</option>
      <option value="legal" data-en="Legal / Compliance" data-hi="‡§ï‡§æ‡§®‡•Ç‡§®‡•Ä / ‡§Ö‡§®‡•Å‡§™‡§æ‡§≤‡§®">Legal / Compliance</option>
      <option value="health" data-en="Healthcare" data-hi="‡§π‡•á‡§≤‡•ç‡§•‡§ï‡•á‡§Ø‡§∞">Healthcare</option>
      <option value="insurance" data-en="Insurance" data-hi="‡§¨‡•Ä‡§Æ‡§æ">Insurance</option>
      <option value="govt" data-en="Government / Public" data-hi="‡§∏‡§∞‡§ï‡§æ‡§∞‡•Ä / ‡§∏‡§æ‡§∞‡•ç‡§µ‡§ú‡§®‡§ø‡§ï">Government / Public</option>
      <option value="ecom" data-en="E-commerce" data-hi="‡§à-‡§ï‡•â‡§Æ‡§∞‡•ç‡§∏">E-commerce</option>
      <option value="edu" data-en="Education / Research" data-hi="‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ / ‡§Ö‡§®‡•Å‡§∏‡§Ç‡§ß‡§æ‡§®">Education / Research</option>
      <option value="enterprise" data-en="Enterprise Security" data-hi="‡§è‡§Ç‡§ü‡§∞‡§™‡•ç‡§∞‡§æ‡§á‡§ú ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§æ">Enterprise Security</option>
    </select>
    <div class="field-label" id="lbl-input">MESSAGE / SMS / LINK</div>
    <textarea id="input-text" placeholder="Paste SMS, WhatsApp message, or link here..."></textarea>
    <div class="char-row">
      <button class="clear-btn" id="clear-btn">‚úï CLEAR</button>
      <span class="char-count"><span id="char-val">0</span> / 1000</span>
    </div>
    <button id="analyze-btn"><span id="btn-text">‚ö° ANALYZE RISK SIGNALS</span></button>
    <div class="no-data">
      <span id="nd1">No Login</span>
      <span id="nd2">No Permissions</span>
      <span id="nd3">No Data Stored</span>
    </div>
  </div>

  <div id="result-card"></div>

  <details class="disclaimer">
    <summary id="disc-title">Legal Disclaimer</summary>
    <div class="disclaimer-body" id="disc-body">This tool analyzes text for commonly known risk patterns based on deterministic rules. It does not guarantee fraud detection accuracy and does not make decisions for you. Final responsibility always remains with the user.</div>
  </details>

  <footer>¬© <span>Veritas Engine</span> ‚Äî Open Risk Awareness Tool</footer>
</div>

<script>
/* ================= ENGINE ================= */
const ENGINE_URL = "https://api.veritasengine.in/api/decide
async function callEngine(inputText) {
  try {
    const res = await fetch(ENGINE_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ input: inputText })
    });
    if (!res.ok) throw new Error("engine error");
    const data = await res.json();
    // aapka engine 'decision' deta hai
    return {
      verdict:     data.decision,
      confidence:  data.confidence  || 0,
      fired_rules: data.fired_rules || [],
      hash:        data.hash        || "pending",
      dsc:         data.dsc         || null
    };
  } catch (e) {
    console.error(e);
    return null;
  }
}

/* ================= TRANSLATIONS ================= */
const T = {
  en: {
    warn:"‚ö† This tool analyzes text for known risk patterns. It does NOT confirm fraud. Final responsibility remains with the user.",
    tagline:"EXPLAIN RISK ¬∑ DON'T DEMAND TRUST",
    lblUsecase:"USE CASE",lblInput:"MESSAGE / SMS / LINK",
    placeholder:"Paste SMS, WhatsApp message, or link here...",
    btnText:"‚ö° ANALYZE RISK SIGNALS",analyzing:"ANALYZING...",
    nd1:"No Login",nd2:"No Permissions",nd3:"No Data Stored",
    scanned:"Scanned",flagged:"Flagged",
    discTitle:"Legal Disclaimer",
    discBody:"This tool analyzes text for commonly known risk patterns based on deterministic rules. It does not guarantee fraud detection accuracy and does not make decisions for you. Final responsibility always remains with the user.",
    verdictLabel:["GENUINE / NORMAL","NEEDS ATTENTION","SUSPICIOUS","FRAUD LIKELY"],
    verdictDesc:["No risk patterns detected","Minor signals ‚Äî stay alert","Multiple risk signals detected","High risk ‚Äî do not proceed"],
    verdictEmoji:["‚úÖ","‚ö†Ô∏è","üî∂","üö®"],
    confLabel:"CONFIDENCE SCORE",reasonsLabel:"TRIGGERED PATTERNS",
    hashLabel:"PROOF HASH",dscLabel:"DSC STATUS",timeLabel:"TIMESTAMP",
    noReasons:"No specific patterns triggered",
    shareTitle:"SHARE REPORT",btnCopy:"üìã Copy",btnPdf:"üìÑ PDF",btnShare:"üì§ Share",copied:"Copied!",
    reportTitle:"VERITAS GUARD ‚Äî RISK ANALYSIS REPORT",
    reportFooter:"This report is generated by Veritas Guard. Final responsibility remains with the user.",
    reportNone:"None"
  },
  hi: {
    warn:"‚ö† ‡§Ø‡§π ‡§ü‡•Ç‡§≤ ‡§ï‡•á‡§µ‡§≤ ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§¶‡§ø‡§ñ‡§æ‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ‡•§ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ú‡§º‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•Ä ‡§π‡•à‡•§",
    tagline:"‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Æ‡§ù‡§æ‡§á‡§è ¬∑ ‡§≠‡§∞‡•ã‡§∏‡§æ ‡§Æ‡§§ ‡§Æ‡§æ‡§Ç‡§ó‡§ø‡§è",
    lblUsecase:"‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞",lblInput:"‡§∏‡§Ç‡§¶‡•á‡§∂ / SMS / ‡§≤‡§ø‡§Ç‡§ï",
    placeholder:"SMS, WhatsApp ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§Ø‡§æ ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§ö‡§ø‡§™‡§ï‡§æ‡§è‡§Å...",
    btnText:"‚ö° ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§ú‡§æ‡§Ç‡§ö‡•á‡§Ç",analyzing:"‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...",
    nd1:"‡§ï‡•ã‡§à ‡§≤‡•â‡§ó‡§ø‡§® ‡§®‡§π‡•Ä‡§Ç",nd2:"‡§ï‡•ã‡§à ‡§Ö‡§®‡•Å‡§Æ‡§§‡§ø ‡§®‡§π‡•Ä‡§Ç",nd3:"‡§ï‡•ã‡§à ‡§°‡•á‡§ü‡§æ ‡§®‡§π‡•Ä‡§Ç",
    scanned:"‡§ú‡§æ‡§Ç‡§ö‡•á ‡§ó‡§è",flagged:"‡§∏‡§Ç‡§¶‡§ø‡§ó‡•ç‡§ß",
    discTitle:"‡§ï‡§æ‡§®‡•Ç‡§®‡•Ä ‡§Ö‡§∏‡•ç‡§µ‡•Ä‡§ï‡§∞‡§£",
    discBody:"‡§Ø‡§π ‡§ü‡•Ç‡§≤ ‡§ï‡•á‡§µ‡§≤ ‡§®‡§ø‡§∞‡•ç‡§ß‡§æ‡§∞‡§ø‡§§ ‡§®‡§ø‡§Ø‡§Æ‡•ã‡§Ç ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ ‡§ú‡•ç‡§û‡§æ‡§§ ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§ï‡§æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§ ‡§Ø‡§π ‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§¶‡•á‡§§‡§æ ‡§î‡§∞ ‡§ï‡•ã‡§à ‡§®‡§ø‡§∞‡•ç‡§£‡§Ø ‡§®‡§π‡•Ä‡§Ç ‡§≤‡•á‡§§‡§æ‡•§ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ú‡§º‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•Ä ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§",
    verdictLabel:["‡§∏‡§æ‡§Æ‡§æ‡§®‡•ç‡§Ø / ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï","‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç","‡§∏‡§Ç‡§¶‡§ø‡§ó‡•ç‡§ß","‡§ß‡•ã‡§ñ‡§æ‡§ß‡§°‡§º‡•Ä ‡§∏‡§Ç‡§≠‡§µ"],
    verdictDesc:["‡§ï‡•ã‡§à ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ","‡§õ‡•ã‡§ü‡•á ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§Æ‡§ø‡§≤‡•á ‚Äî ‡§∏‡§§‡§∞‡•ç‡§ï ‡§∞‡§π‡•á‡§Ç","‡§ï‡§à ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Ç‡§ï‡•á‡§§ ‡§Æ‡§ø‡§≤‡•á","‡§â‡§ö‡•ç‡§ö ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‚Äî ‡§Ü‡§ó‡•á ‡§® ‡§¨‡§¢‡§º‡•á‡§Ç"],
    verdictEmoji:["‚úÖ","‚ö†Ô∏è","üî∂","üö®"],
    confLabel:"‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§∏‡•ç‡§ï‡•ã‡§∞",reasonsLabel:"‡§∏‡§ï‡•ç‡§∞‡§ø‡§Ø ‡§™‡•à‡§ü‡§∞‡•ç‡§®",
    hashLabel:"‡§™‡•ç‡§∞‡•Ç‡§´ ‡§π‡•à‡§∂",dscLabel:"DSC ‡§∏‡•ç‡§•‡§ø‡§§‡§ø",timeLabel:"‡§∏‡§Æ‡§Ø",
    noReasons:"‡§ï‡•ã‡§à ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§™‡•à‡§ü‡§∞‡•ç‡§® ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ",
    shareTitle:"‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∂‡•á‡§Ø‡§∞ ‡§ï‡§∞‡•á‡§Ç",btnCopy:"üìã ‡§ï‡•â‡§™‡•Ä",btnPdf:"üìÑ PDF",btnShare:"üì§ ‡§∂‡•á‡§Ø‡§∞",copied:"‡§ï‡•â‡§™‡•Ä ‡§π‡•ã ‡§ó‡§Ø‡§æ!",
    reportTitle:"‡§µ‡•á‡§∞‡§ø‡§ü‡§æ‡§∏ ‡§ó‡§æ‡§∞‡•ç‡§° ‚Äî ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§£ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü",
    reportFooter:"‡§Ø‡§π ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§µ‡•á‡§∞‡§ø‡§ü‡§æ‡§∏ ‡§ó‡§æ‡§∞‡•ç‡§° ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡•Ä ‡§ó‡§à ‡§π‡•à‡•§ ‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§ú‡§º‡§ø‡§Æ‡•ç‡§Æ‡•á‡§¶‡§æ‡§∞‡•Ä ‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•Ä ‡§π‡•à‡•§",
    reportNone:"‡§ï‡•ã‡§à ‡§®‡§π‡•Ä‡§Ç"
  }
};

/* ================= STATE ================= */
let lang = localStorage.getItem('vg_lang') || 'en';
let scanCount = 0;
let flagCount = 0;
let lastResult = null;
let lastInput = '';

/* ================= LANG ================= */
function setLang(l) {
  lang = l;
  localStorage.setItem('vg_lang', l);
  applyLang();
}

function applyLang() {
  const t = T[lang];
  document.getElementById('warn-text').textContent = t.warn;
  document.getElementById('tagline-text').textContent = t.tagline;
  document.getElementById('lbl-usecase').textContent = t.lblUsecase;
  document.getElementById('lbl-input').textContent = t.lblInput;
  document.getElementById('input-text').placeholder = t.placeholder;
  document.getElementById('btn-text').textContent = t.btnText;
  document.getElementById('nd1').textContent = t.nd1;
  document.getElementById('nd2').textContent = t.nd2;
  document.getElementById('nd3').textContent = t.nd3;
  document.getElementById('lbl-scanned').textContent = t.scanned;
  document.getElementById('lbl-flagged').textContent = t.flagged;
  document.getElementById('disc-title').textContent = t.discTitle;
  document.getElementById('disc-body').textContent = t.discBody;
  document.querySelectorAll('#usecase option').forEach(o => {
    o.textContent = lang === 'hi' ? o.dataset.hi : o.dataset.en;
  });
  document.getElementById('btn-en').classList.toggle('active', lang === 'en');
  document.getElementById('btn-hi').classList.toggle('active', lang === 'hi');
}

/* ================= INIT ================= */
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById('btn-en').addEventListener('click', () => setLang('en'));
  document.getElementById('btn-hi').addEventListener('click', () => setLang('hi'));

  document.getElementById('input-text').addEventListener('input', function() {
    document.getElementById('char-val').textContent = this.value.length;
  });

  document.getElementById('clear-btn').addEventListener('click', () => {
    document.getElementById('input-text').value = '';
    document.getElementById('char-val').textContent = '0';
    document.getElementById('result-card').style.display = 'none';
    lastResult = null;
    lastInput = '';
  });

  document.getElementById('analyze-btn').addEventListener('click', async () => {
    const text = document.getElementById('input-text').value.trim();
    if (!text) {
      document.getElementById('input-text').style.borderColor = 'var(--accent2)';
      setTimeout(() => document.getElementById('input-text').style.borderColor = '', 1000);
      return;
    }
    const t = T[lang];
    const btn = document.getElementById('analyze-btn');
    btn.classList.add('loading');
    document.getElementById('btn-text').textContent = t.analyzing;

    const r = await callEngine(text);

    btn.classList.remove('loading');
    document.getElementById('btn-text').textContent = t.btnText;

    if (!r || r.verdict === undefined) {
      alert("‚ùå Engine not reachable ‚Äî check server");
      return;
    }

    scanCount++;
    if (r.verdict >= 2) flagCount++;
    document.getElementById('stat-scanned').textContent = scanCount;
    document.getElementById('stat-flagged').textContent = flagCount;

    lastResult = r;
    lastInput = text;
    showResult(r, t);
  });

  applyLang();
});

/* ================= SHOW RESULT ================= */
function showResult(r, t) {
  const v = r.verdict;
  const vc = 'c' + v;
  const bg = 'bg' + v;
  const fi = 'fill' + v;

  const reasons = r.fired_rules && r.fired_rules.length > 0
    ? r.fired_rules.map(rule => '<span class="reason-tag ' + vc + '">' + rule + '</span>').join('')
    : '<span class="reason-tag" style="color:var(--muted);border-color:var(--border)">' + t.noReasons + '</span>';

  const dscRow = r.dsc
    ? '<div class="hash-row"><span class="hash-key">' + t.dscLabel + '</span><span class="hash-val" style="color:var(--accent3)">' + r.dsc.status + '</span></div>'
    : '';

  const now = new Date().toLocaleString();
  const result = document.getElementById('result-card');

  result.innerHTML =
    '<div class="result-header ' + bg + '">' +
      '<div class="verdict-icon ' + bg + '">' + t.verdictEmoji[v] + '</div>' +
      '<div class="verdict-text">' +
        '<h3 class="' + vc + '">' + t.verdictLabel[v] + '</h3>' +
        '<p>' + t.verdictDesc[v] + '</p>' +
      '</div>' +
    '</div>' +
    '<div class="conf-section">' +
      '<div class="conf-label"><span>' + t.confLabel + '</span><span class="' + vc + '">' + (r.confidence || 0) + '%</span></div>' +
      '<div class="conf-bar"><div class="conf-fill ' + fi + '" id="conf-fill"></div></div>' +
    '</div>' +
    '<div class="reasons-section">' +
      '<div class="reasons-title">' + t.reasonsLabel + '</div>' + reasons +
    '</div>' +
    '<div class="hash-section">' +
      '<div class="hash-row"><span class="hash-key">' + t.hashLabel + '</span><span class="hash-val">' + (r.hash || 'pending') + '</span></div>' +
      dscRow +
      '<div class="hash-row"><span class="hash-key">' + t.timeLabel + '</span><span class="hash-val" style="color:var(--muted)">' + now + '</span></div>' +
    '</div>' +
    '<div class="share-section">' +
      '<div class="share-title">' + t.shareTitle + '</div>' +
      '<div class="share-btns">' +
        '<button class="share-btn" id="copy-btn" onclick="copyReport()">' + t.btnCopy + '</button>' +
        '<button class="share-btn" onclick="downloadPdf()">' + t.btnPdf + '</button>' +
        '<button class="share-btn primary" id="share-btn" onclick="shareReport()">' + t.btnShare + '</button>' +
      '</div>' +
    '</div>';

  result.style.display = 'block';
  setTimeout(() => {
    const fill = document.getElementById('conf-fill');
    if (fill) fill.style.width = (r.confidence || 0) + '%';
  }, 100);
  result.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
}

/* ================= REPORT ================= */
function buildReport(t) {
  if (!lastResult) return '';
  const r = lastResult;
  const patterns = r.fired_rules && r.fired_rules.length > 0 ? r.fired_rules.join(', ') : t.reportNone;
  const dscLine = r.dsc ? t.dscLabel + ': ' + r.dsc.status + '\n' : '';
  return t.reportTitle + '\n' +
    '='.repeat(44) + '\n' +
    t.timeLabel + ': ' + new Date().toLocaleString() + '\n\n' +
    t.verdictLabel[r.verdict] + ' ' + t.verdictEmoji[r.verdict] + '\n' +
    t.confLabel + ': ' + (r.confidence || 0) + '%\n' +
    t.reasonsLabel + ': ' + patterns + '\n' +
    t.hashLabel + ': ' + (r.hash || 'pending') + '\n' +
    dscLine + '\n' +
    '--- ' + (lang === 'hi' ? '‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ø‡§§ ‡§∏‡§Ç‡§¶‡•á‡§∂' : 'Analyzed Message') + ' ---\n' +
    lastInput + '\n\n' +
    '='.repeat(44) + '\n' +
    t.reportFooter;
}

function copyReport() {
  const t = T[lang];
  navigator.clipboard.writeText(buildReport(t)).then(() => {
    const btn = document.getElementById('copy-btn');
    if (btn) { btn.textContent = t.copied; setTimeout(() => btn.textContent = t.btnCopy, 2000); }
  });
}

function shareReport() {
  const t = T[lang];
  const text = buildReport(t);
  if (navigator.share) {
    navigator.share({ title: t.reportTitle, text });
  } else {
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.getElementById('share-btn');
      if (btn) { btn.textContent = t.copied; setTimeout(() => btn.textContent = t.btnShare, 2000); }
    });
  }
}

function downloadPdf() {
  const t = T[lang];
  if (!lastResult) return;
  const r = lastResult;
  const patterns = r.fired_rules && r.fired_rules.length > 0 ? r.fired_rules.join(', ') : t.reportNone;
  const dscRow = r.dsc ? '<div class="row"><span class="lbl">' + t.dscLabel + '</span><span>' + r.dsc.status + '</span></div>' : '';
  const now = new Date().toLocaleString();
  const html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><style>body{font-family:Arial,sans-serif;max-width:600px;margin:40px auto;padding:20px;color:#111}h1{font-size:17px;border-bottom:2px solid #333;padding-bottom:8px;margin-bottom:16px}.verdict{font-size:22px;font-weight:bold;margin:12px 0}.row{display:flex;justify-content:space-between;padding:7px 0;border-bottom:1px solid #eee;font-size:13px}.lbl{color:#666}.hash{font-family:monospace;font-size:11px;word-break:break-all}.msg{background:#f5f5f5;padding:12px;border-radius:6px;font-size:13px;margin:12px 0;line-height:1.6}.footer{margin-top:24px;font-size:11px;color:#999;text-align:center}</style></head><body>' +
    '<h1>' + t.reportTitle + '</h1>' +
    '<div class="row"><span class="lbl">' + t.timeLabel + '</span><span>' + now + '</span></div>' +
    '<div class="verdict">' + t.verdictEmoji[r.verdict] + ' ' + t.verdictLabel[r.verdict] + '</div>' +
    '<div class="row"><span class="lbl">' + t.confLabel + '</span><span>' + (r.confidence||0) + '%</span></div>' +
    '<div class="row"><span class="lbl">' + t.reasonsLabel + '</span><span>' + patterns + '</span></div>' +
    '<div class="row"><span class="lbl">' + t.hashLabel + '</span><span class="hash">' + (r.hash||'pending') + '</span></div>' +
    dscRow +
    '<div class="msg"><b>' + (lang==='hi'?'‡§µ‡§ø‡§∂‡•ç‡§≤‡•á‡§∑‡§ø‡§§ ‡§∏‡§Ç‡§¶‡•á‡§∂:':'Analyzed Message:') + '</b><br>' + lastInput + '</div>' +
    '<div class="footer">' + t.reportFooter + '</div></body></html>';
  const blob = new Blob([html], { type: 'text/html' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'veritas-report-' + Date.now() + '.html'; a.click();
  URL.revokeObjectURL(url);
}
</script>
</body>
</html>
